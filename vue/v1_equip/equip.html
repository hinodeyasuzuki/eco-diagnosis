<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="target-densitydpi=device-dpi, width=320, initial-scale=1.0, user-scalable=yes">
	<link href="view/common.css" rel="stylesheet" type="text/css" />
	<title>ペンギン風機器追加</title>
	<style>
		[v-cloak] {
			display: none
		}

		div.setting {
			width: calc(100% - 2px);
			background-color: #cff;
			padding: 10px;
			border: 2px solid #8af;
			position: fixed;
		}

		div.setting div.tips {
			margin-left: 20px;
			background-color: #ffb;
		}

		div.result {
			position: fixed;
			bottom: 0px;
			height: 30px;
			width: calc(100% - 2px);
			background-color: cyan;
			border: solid 1px darkcyan;
		}

		.equip li {
			clear: both;
		}

		.equip li span {
			float: left;
			width: 10%;
			min-width: 60px;
		}

		.equip li span.title {
			width: 140px;
		}

		.equip li span.minus {
			width: 75px;
		}

		span.title button {
			min-width: 100px;
		}

		span.minus button {
			min-width: 60px;
		}

		.equip li span.buttons {
			width: 40%;
			max-width: 350px;
		}

		.equip li span.buttons button {
			background-color: #fbb;
		}

		.inputlist li {
			clear: both;

		}

		.inputlist li span {
			float: left;
			width: 10%;
			min-width: 60px;
		}

		.inputlist li span.spanclick {
			width: 50%;
			max-width: 300px;
		}

		.fade-enter-active,
		.fade-leave-active {
			transition: opacity .5s;
		}

		.fade-enter,
		.fade-leave-to

		/* .fade-leave-active below version 2.1.8 */
			{
			opacity: 0;
		}

		.onlysm {
			display: none;
		}

		/* =========== スマホ画面 ============ */
		@media only screen and (max-width: 600px) {
			.onlysm {
				display: inline;
			}

			.equip li span.title {
				width: 100px;
			}

			.equip li span.buttons {
				width: 100%;
				padding-left: 10px;
			}

			.inputlist li span.spanclick {
				width: 35%;
			}
		}
	</style>
</head>

<body>
	<div id="app" v-cloak>

		<!-- 全体のCO2とペンギン数 -->
		<div class="result">
			<p>合計 CO2:{{Math.round(co2*12)}}kg 平均{{Math.round(average*12)}}kg ペンギン {{penguin}}匹
				<transition name="fade"><b style="background-color:#fbb" v-if="message">{{message}}</b></transition>
			</p>
		</div>

		<!-- 使い方の詳細設定 -->
		<transition name="fade">
			<div class="setting" v-if="inshow">
				<h2>{{equipname}}　の使い方設定</h2>
				<ol class="inputlist">
					<li v-for="(inpone, key) in inp" v-if="key">
						<span class="spanclick">
							{{defInput[key.substr(0,4)].title}}
							<button @click="tips[key] = !tips[key]">?</button>
						</span>

						<span class="selection">
							<select v-model="inp[key]">
								<option v-for="(v,k2) in defSelectValue[key.substr(0,4)]" v-if="v"
									:value="defSelectData[key.substr(0,4)][k2]">
									{{v}}
								</option>
							</select>
						</span>
						<br>

						<div class="tips" v-if="tips[key]">
							<p>{{defInput[key.substr(0,4)].text}}</p>
						</div>
						<br>
					</li>
				</ol>
				<input type="button" @click="clearinp" value="設定する">
			</div>
		</transition>

		<!-- 機器の表示 -->
		<ul class="equip">
			<li>
				<span class="title">機器</span>
				<span class="minus">&nbsp;</span>
				<span class="minus">&nbsp;</span>
				<span>CO2</span><br class="onlysm">
				<span class="buttons">使用機器と使い方設定</span>
			</li>
			<li v-for="(cons,key) in equipCons">
				<span class="title">
					{{cons.name}}
				</span>
				<span class="minus">
					<button v-if="cons.count" @click="addcons(cons.name, cons.cons,key);">増やす</button>
					<button v-if="!cons.count && !cons.num" @click="togglecons(cons.name, cons.cons,key);">使う</button>
					<b v-if="!cons.count && cons.num">&nbsp;</b>
				</span>
				<span class="minus">
					<button v-if="!cons.count && cons.num" @click="togglecons(cons.name, cons.cons,key);">使わない</button>
					<button v-if="cons.count && cons.num" @click="delcons(cons.name, cons.cons,key);">減らす</button>
					<b v-if="!cons.num">&nbsp;</b>
				</span>
				<span>
					{{cons.co2 ? Math.round(cons.co2) : 0}}kg
				</span><br class="onlysm">
				<span class="buttons">
					<template v-for="id in cons.num">
						<button
							@click="showinput( cons,key,id);">{{(cons.count ? cons.name + id + cons.count + "目" : cons.name)}}</button>
					</template>
				</span>
				<Br>
			</li>
		</ul>
		<p>&nbsp;</p>

	</div>


	<?php
		echo $jssets;
		echo $scripts;
		echo $jsgoogle;
		echo $jsgoogle_analytics;
	?>

	<script src="./vue/v1_equip/d6calc.js"></script>
	<script src="./vue/v1_equip/equip.js"></script>

	<script>
		//Vueの定義
		var app = new Vue({
			el: ' #app', //Vue変数 
			data: {
				//表示機器
				equipCons: [	//consid: consOTotherの場合のcons.subID
					{ cons: "consTV", name: "テレビ", count: "台", num: 0, maxnum: 0, ques: ["i631", "i632", "i633"] },
					{ cons: "consOTother", name: "録画機器", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "ノートパソコン", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "デスクトップパソコン", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "据置ゲーム機", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "インターネットモデム", count: "", num: 0, maxnum: 0 },
					{ cons: "consLI", name: "照明", count: "部屋", num: 0, maxnum: 0, ques: ["i512", "i513", "i514", "i515"] },
					{ cons: "consRF", name: "冷蔵庫", count: "台", num: 0, maxnum: 0, ques: ["i711", "i712", "i713", "i714", "i715", "i716", "i721"] },
					{ cons: "consDRsum", name: "洗濯機", count: "", num: 0, maxnum: 0 },
					{ cons: "consACheat", name: "暖房", count: "部屋", num: 0, maxnum: 0, ques: ["i212", "i213", "i214", "i215", "i216", "i217", "i231", "i232", "i233", "i234", "i235"] },
					{ cons: "consACcool", name: "冷房", count: "部屋", num: 0, maxnum: 0, ques: ["i212", "i215", "i216", "i217", "i271", "i273", "i274"] },
					{ cons: "consOTother", name: "除湿機", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "加湿機", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "空気清浄機", count: "台", num: 0, maxnum: 0 },
					//	{ cons: "consOTother", name: "扇風機", count: "台", num: 0, maxnum: 0 },
					{ cons: "consHWtub", name: "風呂", count: "", num: 0, maxnum: 0, ques: ["i101", "i103", "i104"] },
					{ cons: "consHWshower", name: "シャワー", count: "", num: 0, maxnum: 0, ques: ["i105", "i106", "i112", "i116"] },
					{ cons: "consOTother", name: "換気扇", count: "台", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "ヘアドライヤー", count: "台", num: 0, maxnum: 0 },
					{ cons: "consCKcook", name: "コンロ", count: "", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "電子レンジ", count: "", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "炊飯器", count: "", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "トースター", count: "", num: 0, maxnum: 0 },
					{ cons: "consCKpot", name: "ポット", count: "", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "掃除機", count: "", num: 0, maxnum: 0 },
					{ cons: "consOTother", name: "熱帯魚水槽", count: "台", num: 0, maxnum: 0 },
					{ cons: "consCR", name: "車", count: "台", num: 0, maxnum: 0, ques: ["i912", "i922", "i923"] }
				],


				co2: 0, reduceCO2: 0, cost: 0, reduceCost: 0, //画面定義 

				//選択画面
				inshow: false,
				input_codes: ["i101"],
				equipname: "",
				message: "",
				inp: {},
				defInput: {}, //入力定義 ixxxごと
				defSelectValue: {}, //選択肢表示値 ixxxに変換 
				defSelectData: {}, //選択肢選択値 ixxxに変換 
				defCons: {}, //消費クラス（追加定義）の入力定義
				defConsMeasures: {}, //消費クラスの提案リスト定義 
				defConsThema: {}, //家で気になるところ定義 defInputGroup で定義 
				defConsShow: {}, //分野定義 
				tips: {},

				selects: {},
				eqlist: {},
				cons_count: {},
				other_count: 0,
				important_items: {},
				rank100: 1,
				averageComment: "",
				averageCO2Comment: "",
				pageResult: {},
				average: 0,

				measures: [],
				measures_selectafter: [],
				measures_selectalready: [],
				measures_selectno: [],
			},
			methods: {

				//機器を増やす
				addcons: function (title, consName, key) {
					var add = 0;	//D6クラスに消費クラスを伝えるかどうか
					Vue.set(this.equipCons[key], "num", this.equipCons[key].num + 1);
					if (!this.cons_count[key] || this.cons_count[key] < this.equipCons[key].num) {
						//最大値保存（品目ごと）
						Vue.set(this.cons_count, key, this.equipCons[key].num);
						if (consName == "consOTother") {
							//その他では品目ごと超えたら追加
							add = 1;
						}
					}

					if (!D6.consListByName[consName][this.equipCons[key].num]) {
						//その他以外は、消費クラス数で追加
						add = 1;
					}
					equipadd(consName, key, this.equipCons[key].num, add);	//機器追加
				},

				//機器削減
				//削減については、利用量を0として、単に消費として表示をしないだけ。
				delcons: function (title, consName, key) {
					Vue.set(this.equipCons[key], "num", this.equipCons[key].num - 1);
					equipdel(consName, key, this.equipCons[key].num + 1);	//機器削除
				},

				//使用している/していないの選択
				togglecons: function (title, consName, key) {
					var add = 0;
					Vue.set(this.equipCons[key], "num", 1 - this.equipCons[key].num);
					if (this.equipCons[key].num == 0) {
						equipdel(consName, key, 1);	//機器削除

					} else {
						if (this.cons_count[key] != 1) {
							add = 1;
						}
						Vue.set(this.cons_count, key, 1);
						equipadd(consName, key, 1, add);	//機器追加
					}

				},

				//機器のCO2計算（すべて）
				calcco2: function () {//機器ごとのCO2の計算をして、設定する
					var co2;
					var co2sum = 0;
					for (var k in this.equipCons) {
						co2 = 0;
						switch (this.equipCons[k].cons) {
							case "consOTother":
								for (var k2 in D6.consListByName["consOTother"]) {
									var c = D6.consListByName["consOTother"][k2];
									if (c.name == this.equipCons[k].name) {
										co2 += c.co2;
									}
								}
								break;
							case "consTV":
							case "consLI":
							case "consRF":
							case "consCR":
							case "consACheat":
							case "consACcool":
								for (var k2 in D6.consListByName[this.equipCons[k].cons]) {
									if (k2 > 0) {
										co2 += D6.consListByName[this.equipCons[k].cons][k2].co2;
									}
								}
								break;
							case "consHWtub":
							case "consHWshower":
							case "consDRsum":
							case "consCKcook":
							case "consCKpot":
								co2 = D6.consListByName[this.equipCons[k].cons][0].co2;
								break;

						}
						Vue.set(this.equipCons[k], "co2", co2 * 12);
						co2sum += (co2 ? co2 : 0);
					}
					Vue.set(this, "co2", co2sum);
					Vue.set(this, "average", D6.consTotal.co2Original);
				},

				//ボタンをおして入力ダイアログを表示
				// key:equip配列の番号、id:equipの中の番号
				showinput: function (cons, key, id) {
					for (var k in app.inp) {
						D6.doc.data[k] = app.inp[k];
					}
					Vue.set(app, "inp", {});	//現在表示されているものを消す
					equipCalc();

					//inp[i***]	に D6.doc.dataの値をコピー　終了時に反映させる
					var subID = "";
					var c = 0;
					if (cons.cons == "consOTother") {
						//otherの場合には番号がずれる
						var ename = app.equipCons[key].name;
						for (var k in D6.consListByName["consOTother"]) {
							if (D6.consListByName["consOTother"][k].name == ename) {
								c++;
								if (c == id) {
									subID = parseInt(k);
								}
							}
						}
						cons.ques = ["i654", "i655", "i656"];
						Vue.set(this, "equipname", cons.name + (cons.count ? (" " + id + cons.count + "目") : ""));
					} else if (cons.count) {
						//カウンタブルの場合
						subID = 0 + id;	//+1にしないとエラー　バグ
						Vue.set(this, "equipname", cons.name + (cons.count ? (" " + subID + cons.count + "目") : ""));
					}
					//n台目、消費番号c
					for (var k in cons.ques) {
						var dat = D6.doc.data[cons.ques[k] + subID];
						Vue.set(this.inp, cons.ques[k] + subID, dat ? dat : -1);
						Vue.set(this.tips, cons.ques[k] + subID, false);
					}
					Vue.set(this, "inshow", true);
					//console.log(this.inp);
				},

				//入力画面を消す
				clearinp: function () {
					Vue.set(app, "inshow", false);
					for (var k in app.inp) {
						D6.doc.data[k] = app.inp[k];
					}
					Vue.set(app, "inp", {});
					Vue.set(app, "tips", {});
					equipCalc();
				}

			},
			created: function () {

			},
			computed: {
				penguin: function () {
					return Math.round((this.average * 2 - this.co2) / this.average * 10);
				}

			},
			watch: {

			}
		}); //初期ロード時設定

		window.onload = function () {
			$(window).on("beforeunload", function () {
				file.saveToLocal(); //文字指定はIEしかサポートしていない return "診断を終了しますがよろしいですか？　ページを移動する場合には、ページ内のボタンやメニューを使ってください。"
			}); //初期データ読み込み 
			var param = {};
			param["get"] = { "scenario": 1 };
			callGetScenario(param);
			D6.fg_calccons_not_calcConsAdjust = true;
			equipinit();
			Vue.set(app, "co2", 0);
		}; 
	</script>
</body>

</html>