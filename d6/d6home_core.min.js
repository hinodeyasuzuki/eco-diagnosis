var D6=D6||{};onmessage=function(event){var param=event.data.param;if(!event.data.param){param=""}if(typeof(param.targetMode)!="undefined"){D6.targetMode=param.targetMode};var result=D6.workercalc(event.data.command,param);try{postMessage({"command":event.data.command,"result":result},"http://"+window.location.hostname)}catch(e){postMessage({"command":event.data.command,"result":result})}};D6.workercalc=function(command,param){var result={};var ad;switch(command){case"start":D6.viewparam=D6.viewparam||{};D6.viewparam.ode=param.ode;D6.viewparam.focusMode=param.focusMode;D6.viewparam.countfix_pre_after=param.countfix_pre_after;if(param.debugMode&&param.debugMode==1){D6.debugMode=true}else{D6.debugMode=false}D6.constructor(param.prohibitQuestions,param.allowedQuestions,param.defInput);if(typeof(param.rdata)!="undefined"&&param.rdata){try{D6.doc.loadDataSet(decodeURIComponent(escape(atob(param.rdata))))}catch(e){}}D6.calculateAll();result=D6.getAllResult("consTotal");result.inputPage=D6.getInputPage(param.consName,param.subName);result.quesone=D6.getFirstQues(param.consName,param.subName);if(D6.debugMode){console.log("d6 construct value ----");console.log(D6)}break;case"addandstart":var serialize=D6.doc.serialize();param.rdata=btoa(unescape(encodeURIComponent(serialize)));D6.addConsSetting(param.consName);D6.setscenario("add");if(typeof(param.rdata)!="undefined"){D6.doc.loadDataSet(decodeURIComponent(escape(atob(param.rdata))),"add")}D6.calculateAll();var showName=D6.consListByName[param.consName][0].sumConsName;result=D6.getAllResult(showName);result.inputPage=D6.getInputPage(showName,param.subName);break;case"tabclick":result=D6.getAllResult(param.consName);result.inputPage=D6.getInputPage(param.consName,param.subName);result.quesone=D6.getFirstQues(param.consName,param.subName);break;case"subtabclick":result.inputPage=D6.getInputPage(param.consName,param.subName);result.subName=param.subName;break;case"inchange":D6.inSet(param.id,param.val);if(param.id==D6.scenario.measuresSortChange){D6.sortTarget=D6.scenario.measuresSortTarget[param.val<0?0:param.val]}D6.calculateAll();result=D6.getAllResult();break;case"inchange_only":D6.inSet(param.id,param.val);result="ok";break;case"quesone_next":result.quesone=D6.getNextQues();break;case"quesone_prev":result.quesone=D6.getPrevQues();break;case"quesone_set":D6.inSet(param.id,param.val);result.quesone=D6.getNextQues();break;case"recalc":D6.calculateAll();result=D6.getAllResult(param.consName);result.inputPage=D6.getInputPage(param.consName,param.subName);break;case"pagelist":result.inputPage=D6.getInputPage(param.consName,param.subName);break;case"measureadd":case"measureadd_comment":D6.measureAdd(param.mid);D6.calcMeasures(-1);result=D6.getAllResult();break;case"measuredelete":D6.measureDelete(param.mid);D6.calcMeasures(-1);result=D6.getAllResult();break;case"graphchange":result.itemize_graph=D6.getItemizeGraph("",param.graph);break;case"evaluateaxis":result.evaluateAxis=D6.getEvaluateAxisPoint("",param.subName);break;case"add_demand":var serialize=D6.doc.serialize();param.rdata=btoa(unescape(encodeURIComponent(serialize)));D6.addConsSetting(param.consName);D6.setscenario("add");if(param.rdata){D6.doc.loadDataSet(decodeURIComponent(escape(atob(param.rdata))),"add")}case"demand":result.demandin=D6.getInputDemandSumup();result.demandlog=D6.getInputDemandLog();result.graphDemand=D6.getDemandGraph();break;case"inchange_demand":D6.inSet(param.id,param.val);result.graphDemand=D6.getDemandGraph();break;case"modal":var id=param.mid;result.measure_detail=D6.getMeasureDetail(id);break;case"save":case"savenew":case"saveandgo":case"save_noalert":var serialize=D6.doc.serialize();result=btoa(unescape(encodeURIComponent(serialize)));break;case"load":break;case"getinputpage":result.inputPage=D6.getInputPage(param.consName,param.subName);break;case"getqueslist":result.queslist=D6.getQuesList();break;case"common":var measurechange=false;if(typeof(param.construct)!="undefined"&&param.construct){D6.constructor(param.prohibitQuestions,param.allowedQuestions,param.defInput)}if(typeof(param.rdata)!="undefined"&&param.rdata){try{D6.doc.loadDataSet(decodeURIComponent(escape(atob(param.rdata))))}catch(e){}}if(typeof(param.id)!="undefined"&&param.id){D6.inSet(param.id,param.val)}if(typeof(param.inputs)!="undefined"&&param.inputs){for(var inp in param.inputs){D6.inSet(param.inputs[inp].id,param.inputs[inp].val)}}if(typeof(param.addmeasureid)!="undefined"&&param.addmeasureid){D6.measureAdd(param.addmeasureid);measurechange=true}if(typeof(param.deletemeasureid)!="undefined"&&param.deletemeasureid){D6.measureDelete(param.deletemeasureid);measurechange=true}if(measurechange){D6.calcMeasures(-1);result=D6.getAllResult()}else if(typeof(param.calc)=="undefined"||param.calc){D6.calculateAll(-1)}if(typeof(param.getresult)=="undefined"||param.getresult){result=D6.getAllResult()}if(typeof(param.getinput)=="undefined"||param.getinput){result.inputPage=D6.getInputPage(param.consName,param.subName)}break;default:};return result};var D6=D6||{};D6.object=function(obj){var func=D6.object.func;func.prototype=obj;var newo=new func;var len=arguments.length;for(var i=1;i<len;++i){for(var prop in arguments[i]){newo[prop]=arguments[i][prop]}}return newo};D6.object.func=function(){};D6.patch=function(target,fix){for(var v in fix){target[v]=fix[v]}return target};if(typeof(atob)=="undefined"){function atob(str){return str};function btoa(str){return str}};﻿D6.acadd={factorPrefTimeMonth:[[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],[[0.17,0.16,0.14,0.12,0.09,0.06,0.05],[0.06,0.05,0.04,0.04,0.03,0.02,0.01],[0.09,0.09,0.07,0.06,0.04,0.03,0.02],[0.16,0.15,0.13,0.11,0.09,0.06,0.04]]],getArray:function(prefParam){var ret;var pref=prefParam;if(pref>47||pref<0){pref=0}ret=this.factorPrefTimeMonth[parseInt(pref)];return ret}};﻿D6.accons={factorPrefTimeMonth:[[[0.69,0.65,0.6,0.56,0.5,0.42,0.38,0.34,0.33,0.28,0.23,0.18],[0.45,0.42,0.39,0.36,0.32,0.28,0.27,0.65,0.63,0.55,0.48,0.39],[0.53,0.5,0.46,0.43,0.38,0.32,0.31,0.46,0.44,0.4,0.34,0.28],[0.68,0.63,0.59,0.55,0.5,0.41,0.37,0.29,0.28,0.24,0.2,0.16]],[[1.24,1.22,1.21,1.18,1.13,0.94,0.77,0.06,0.05,0.03,0.02,0.02],[1.14,1.13,1.1,1.05,0.98,0.8,0.67,0.2,0.17,0.13,0.1,0.08],[1.2,1.19,1.16,1.13,1.06,0.88,0.72,0.1,0.08,0.05,0.04,0.03],[1.24,1.22,1.21,1.18,1.13,0.95,0.79,0.03,0.02,0.01,0.01,0.01]]],getArray:function(prefParam){var ret;var pref=prefParam;if(pref>47||pref<0){pref=0}ret=this.factorPrefTimeMonth[pref];return ret}};﻿D6.acload={factorPrefTimeMonth:[[[0.66,0.63,0.6,0.57,0.52,0.52,0.44,0.48,0.48,0.39,0.33,0.26],[0.5,0.47,0.44,0.41,0.36,0.31,0.31,0.78,0.76,0.69,0.61,0.51],[0.56,0.53,0.5,0.47,0.42,0.36,0.34,0.62,0.6,0.54,0.47,0.38],[0.65,0.62,0.59,0.56,0.52,0.43,0.39,0.41,0.4,0.34,0.29,0.22]],[[1.06,1.05,1.03,1,0.95,0.95,0.82,0.09,0.09,0.05,0.03,0.02],[0.93,0.92,0.9,0.87,0.83,0.7,0.59,0.27,0.23,0.18,0.14,0.11],[0.99,0.98,0.96,0.93,0.88,0.76,0.64,0.14,0.11,0.07,0.05,0.04],[1.05,1.04,1.02,0.99,0.95,0.83,0.7,0.04,0.03,0.02,0.01,0.01]],],getArray:function(prefParam){var ret;var pref=prefParam;if(pref>47||pref<0){pref=0}ret=this.factorPrefTimeMonth[pref];return ret}};﻿D6.area={prefName:['hyogo',"hokkaido",],prefDefault:0,prefHeatingLeverl:[4,1,2,2,3,2,2,3,3,3,3,4,4,4,4,3,3,3,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,4,4,4,4,4,5,5,6],co2ElectCompanyUnit:[0.55,0.55,0.55,0.55,0.55,0.55,0.55,0.55,0.55,0.55,0.55],prefToEleArea:[5,0,1,1,1,1,1,1,2,2,2,2,2,2,2,1,4,4,4,2,3,3,3,3,3,5,5,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,9],electCompanyPrice:[1.2,1,1,1,1,1,1,1,1,1.2],elecPrice:{1:[33.32,33.32,33.32,-1500,0],2:[33.32,33.32,33.32,-1500,280],3:[38.89,27.32,13.10,2160,0],4:[17.98,16.53,16.53,0,1054],5:[20.22,18.56,18.56,64800,0],6:[22.58,17.36,13.08,0,1733]},prefTemplature:[17.4,9.4,],prefPVElectricity:[4.04,3.95,],energyCode2id:{"electricity":0,"gas":1,"kerosene":2,"car":3},seasonCode2id:{"winter":0,"spring":1,"summer":2},seasonMonth:{winter:4,spring:5,summer:3},airconFactor_mon:[[0.66,0.62,0.59,0.55,0.50,0.41,0.37,0.39,0.36,0.31,0.26,0.20],[0.43,0.39,0.37,0.34,0.30,0.27,0.26,0.79,0.75,0.67,0.59,0.49],[0.47,0.45,0.42,0.39,0.35,0.30,0.29,0.57,0.55,0.49,0.43,0.35],[0.62,0.58,0.55,0.51,0.47,0.39,0.35,0.34,0.32,0.27,0.23,0.18]],heatFactor_mon:[[0.64,0.61,0.60,0.57,0.53,0.53,0.44,0.54,0.54,0.43,0.36,0.28],[0.48,0.45,0.42,0.39,0.34,0.30,0.30,0.88,0.85,0.78,0.70,0.59],[0.52,0.49,0.47,0.43,0.39,0.33,0.32,0.72,0.70,0.64,0.56,0.46],[0.62,0.59,0.57,0.54,0.50,0.42,0.38,0.48,0.45,0.39,0.32,0.25]],plusHeatFactor_mon:[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],getElectCompany:function(pref){return this.prefToEleArea[pref]},getTemplature:function(pref){return this.prefTemplature[pref]},getPVElectricity:function(pref){return this.prefPVElectricity[pref]},getHeatingLevel:function(pref){return this.prefHeatingLeverl[pref]},getCo2Unit:function(electCompany){return this.co2ElectCompanyUnit[electCompany]},getAverageCostEnergy:function(num,pref,urban){var ret;ret=new Array();var id;for(i in this.energyCode2id){id=this.energyCode2id[i];ret[i]=this.prefKakeiEnergy[pref][id]*this.kakeiNumCoefficent[(num>6?6:num)-1][id]*this.urbanCostCoefficient[id][urban]/this.urbanCostCoefficient[id][0]}return ret},getWaterTemplature:function(){var temp=Math.max(5,Math.min(23,0.9137*this.averageTemplature+1.303));return temp},getHeatFactor:function(month,hour){var mIndex;var sum=[0,0,0];var factor=[0,0,0];var count=0;if(month<=0.7){mIndex=0}else if(month<=1.5){mIndex=1}else if(month<=2.5){mIndex=2}else if(month<=3.5){mIndex=3}else if(month<=5){mIndex=4}else if(month<=7){mIndex=5}else{mIndex=6}if(hour>=0){sum[0]+=this.airconFactor_mon[2][mIndex];sum[1]+=this.heatFactor_mon[2][mIndex];sum[2]+=this.plusHeatFactor_mon[2][mIndex];count++}if(hour>6){sum[0]+=this.airconFactor_mon[0][mIndex];sum[1]+=this.heatFactor_mon[0][mIndex];sum[2]+=this.plusHeatFactor_mon[0][mIndex];count++}if(hour>10){sum[0]+=this.airconFactor_mon[1][mIndex];sum[1]+=this.heatFactor_mon[1][mIndex];sum[2]+=this.plusHeatFactor_mon[1][mIndex];count++}if(hour>16){sum[0]+=this.airconFactor_mon[3][mIndex];sum[1]+=this.heatFactor_mon[3][mIndex];sum[2]+=this.plusHeatFactor_mon[3][mIndex];count++}factor[0]=sum[0]/count;factor[1]=sum[1]/count;factor[2]=sum[2]/count;return factor},getCoolFactor:function(month,hour){var mIndex;var sum=[0,0,0];var factor=[0,0,0];var count=0;if(month<=0.7){mIndex=7}else if(month<=1.5){mIndex=8}else if(month<=2.5){mIndex=9}else if(month<=3.5){mIndex=10}else{mIndex=11}if(hour>=0){sum[0]+=this.airconFactor_mon[2][mIndex];sum[1]+=this.heatFactor_mon[2][mIndex];count++}if(hour>6){sum[0]+=this.airconFactor_mon[1][mIndex];sum[1]+=this.heatFactor_mon[1][mIndex];count++}if(hour>12){sum[0]+=this.airconFactor_mon[3][mIndex];sum[1]+=this.heatFactor_mon[3][mIndex];count++}if(hour>18){sum[0]+=this.airconFactor_mon[0][mIndex];sum[1]+=this.heatFactor_mon[0][mIndex];count++}factor[0]=sum[0]/count;factor[1]=sum[1]/count;factor[2]=sum[2]/count;return factor},prefKakeiEnergy:[[7959,5661,313,2647],[7568,5400,3772,3984],],prefSeasonFactorArray:[[[1.1084,1.3537,2.5436,0.9465],[0.8664,0.9165,0.3546,0.9764],[1.0782,0.6675,0.0175,1.1107]],[[1.149,1.1094,1.8254,0.9243],[0.9482,0.9876,0.8169,1.0159],[0.8876,0.8749,0.2047,1.0743]],],getSeasonFactor:function(area){return this.prefSeasonFactorArray[area]},getSeasonParam:function(pref){var param=this.getSeasonFactor(pref);ret=Array();ret["electricity"]=[param[0][0],param[1][0],param[2][0]];ret["gas"]=[param[0][1],param[1][1],param[2][1]];ret["kerosene"]=[param[0][2],param[1][2],param[2][2]];return ret},kakeiNumCoefficent:[[0.47,0.52,0.37,0.45],[0.86,0.83,0.90,0.79],[0.99,1.00,0.90,0.98],[1.07,1.10,0.85,1.16],[1.24,1.17,1.10,1.26],[1.55,1.19,1.67,1.33]],urbanCostCoefficient:[[8762,9618],[6100,5133],[828,1898],[3415,6228]],setPersonArea:function(numPerson,areaId,urbanId){if(urbanId==1||urbanId==2){this.urban=1}else{this.urban=0}if(areaId<0){areaId=this.prefDefault}this.area=Math.round(areaId?areaId:0);this.electCompany=this.getElectCompany(this.area);D6.Unit.price.electricity=D6.Unit.defaultPriceElectricity*this.electCompanyPrice[this.electCompany];D6.Unit.co2.electricity=this.getCo2Unit(this.electCompany);D6.Unit.co2.nightelectricity=D6.Unit.co2.electricity;D6.Unit.co2.sellelectricity=D6.Unit.co2.electricity;this.airconFactor_mon=D6.accons.getArray(this.area);this.heatFactor_mon=D6.acload.getArray(this.area);this.plusHeatFactor_mon=D6.acadd.getArray(this.area);this.averageTemplature=this.getTemplature(this.area);this.unitPVElectricity=1000*this.getPVElectricity(this.area)/3.6;this.heatingLevel=this.getHeatingLevel(this.area);switch(this.heatingLevel){case 1:seasonMonth=[8,3,1];break;case 2:seasonMonth=[6,4,2];break;case 3:seasonMonth=[5,5,2];break;case 5:seasonMonth=[3,5,4];break;case 6:seasonMonth=[2,5,5];break;case 4:default:seasonMonth=[4,5,3];break}this.averageCostEnergy=this.getAverageCostEnergy((numPerson<=0?3:numPerson),Math.floor(this.area),this.urban);this.averageCO2Energy=[];for(var i in this.averageCostEnergy){this.averageCO2Energy[i]=D6.Unit.costToCons(this.averageCostEnergy[i],i)*D6.Unit.co2[i]}},getAverageCons:function(energy_name){var ret=[0,0,0];var eid=this.energyCode2id(energy_name);var avCost=this.averageCostEnergy[energy_name];var seasonArray=this.getSeasonFactor(this.area);ret["winter"]=this.Unit.costToCons(avCost*seasonArray[0][eid],energy_name);ret["spring"]=this.Unit.costToCons(avCost*seasonArray[1][eid],energy_name);ret["summer"]=this.Unit.costToCons(avCost*seasonArray[2][eid],energy_name);return ret},getAverageCostSeason:function(energy_name,season_name){var eid=this.energyCode2id(energy_name);var avCost=this.averageCostEnergy[energy_name];var seasonArray=this.getSeasonFactor(this.area);return avConst*seasonArray[seasonCode2id(season_name)][eid]}};﻿D6.Unit={co2:{electricity:0.55,nightelectricity:0.55,sellelectricity:0.55,nagas:2.23,lpgas:5.98,kerosene:2.49,gasoline:2.32,lightoil:2.62,heavyoil:3,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:2.23,car:2.32},defaultPriceElectricity:27,price:{electricity:27,nightelectricity:10,sellelectricity:30,nagas:150,lpgas:500,kerosene:80,gasoline:130,lightoil:100,heavyoil:80,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:120,car:130},priceBase:{electricity:0,nightelectricity:2100,sellelectricity:0,nagas:1000,lpgas:1000,kerosene:0,gasoline:0,lightoil:0,heavyoil:0,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:800,car:0},name:{electricity:"電気",nightelectricity:"夜間電気",sellelectricity:"売電",nagas:"都市ガス",lpgas:"LPガス",kerosene:"灯油",gasoline:"ガソリン",lightoil:"軽油",heavyoil:"重油",coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:"都市ガス",car:"ガソリン"},unitChar:{electricity:"kWh",nightelectricity:"kWh",sellelectricity:"kWh",nagas:"m3",lpgas:"m3",kerosene:"L",gasoline:"L",lightoil:"L",heavyoil:"L",coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:"m3",car:"L"},calorie:{electricity:860,nightelectricity:860,sellelectricity:860,nagas:11000,lpgas:36000,kerosene:8759,gasoline:8258,lightoil:9117,heavyoil:9000,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:11000,car:8258},jules:{electricity:9.6,nightelectricity:9.6,sellelectricity:9.6,nagas:46,lpgas:60,kerosene:38,gasoline:38,lightoil:38,heavyoil:38,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:45,car:38},costToCons:function(cost,energy_name,elecType,kw){if(typeof kw==='undefined')kw=0;var ret;if(cost==-1||cost==""){ret=""}if(energy_name!="electricity"||typeof(D6.area.elecPrice)==undefined){if(cost<D6.Unit.priceBase[energy_name]*2){ret=cost/D6.Unit.price[energy_name]/2}else{ret=(cost-D6.Unit.priceBase[energy_name])/D6.Unit.price[energy_name]}}else{if(elecType<0||!elecType){if(D6.consShow["TO"].allDenka){elecType=3}else{elecType=1}}var def=D6.area.elecPrice[elecType];ret=(cost-kw*def[4]-def[3])/((def[1]+def[2])/2)}return ret},consToCost:function(cons,energy_name,elecType,kw){var ret;if(cons==-1||cons==""){ret=""}if(energy_name!="electricity"||typeof(D6.area.elecPrice)==undefined){ret=cons*D6.Unit.price[energy_name]}else{if(elecType<0||!elecType){if(D6.consShow["TO"].allDenka){elecType=3}else{elecType=1}}var def=D6.area.elecPrice[elecType];ret=kw*def[4]+cons*(def[1]+def[2])/2;if(ret>def[3]*2){ret-=def[3]}else{ret/=2}}return ret},consToEnergy:function(cons,energy_name){var ret;if(cons==-1||cons==""){ret=""}ret=cons*D6.Unit.jules[energy_name]/1000000;return ret},};D6.Energy={electricity:0,nightelectricity:0,sellelectricity:0,nagas:0,lpgas:0,kerosene:0,gasoline:0,lightoil:0,heavyoil:0,coal:0,biomass:0,hotwater:0,waste:0,water:0,gas:0,car:0,co2:0,jules:0,cost:0,clear:function(){for(var i in D6.Unit.co2){this[i]=0}this.co2=0;this.jules=0;this.cost=0;if(typeof(this.subID)!==undefined&&this.subID!=0){if(D6.viewparam.countfix_pre_after==1){this.mesTitlePrefix=this.countCall+this.subID}else{this.mesTitlePrefix=this.subID+this.countCall}}},calcCO2:function(){this.co2=0;for(var i in D6.Unit.co2){this.co2+=this[i]*D6.Unit.co2[i]}},calcJules:function(){this.jules=0;for(var i in D6.Unit.co2){this.jules+=this[i]*D6.Unit.jules[i]}},calcCost:function(){this.cost=0;for(var i in D6.Unit.co2){this.cost+=this[i]*D6.Unit.price[i]}},multiply:function(rate){for(var i in D6.Unit.co2){this[i]*=rate}this.co2*=rate;this.jules*=rate;this.cost*=rate},multiplyArray:function(marray){for(var i in D6.Unit.co2){this[i]*=marray[i]}this.calcCO2();this.calcJules();this.calcCost()},copy:function(source){for(var i in D6.Unit.co2){this[i]=source[i]}this.co2=source.co2;this.jules=source.jules;this.cost=source.cost;this.endEnergy=source.endEnergy},sub:function(target){for(var i in D6.Unit.co2){this[i]-=target[i]}this.co2-=target.co2;this.jules-=target.jules;this.cost-=target.cost;this.endEnergy-=target.endEnergy},add:function(target){for(var i in D6.Unit.co2){this[i]+=target[i]}this.co2+=target.co2;this.jules+=target.jules;this.cost+=target.cost;this.endEnergy+=target.endEnergy},isSame:function(target){var same=true;for(var i in D6.Unit.co2){if(this[i]!=target[i]){same=false;break}}return same}};﻿D6.ConsBase=D6.object(D6.Energy);D6.ConsBase.init=function(){this.measures=[];this.title="";this.consName="consXX";this.consCode="";this.subID=0;this.groupID=0;this.inputGuide="";this.consShow=[];this.sumCons="";this.sumCons2="";this.sumConsName="";this.sumCons2Name="";this.partCons=[];this.partCons2=[];this.partConsName="";this.partCons2Name="";this.residueCalc="yes";this.performance="";this.mainSource="";this.co2Original="";this.costOriginal="";this.julesOriginal="";this.color="";this.total=false;this.orgCopyNum=0;this.addable="";this.precalc=function(){this.clear()};this.calc=function(){this.clear()};this.calc2nd=function(){};this.calcAdjust=function(energyAdj){this.multiplyArray(energyAdj);this.calcAdjustStrategy(energyAdj)};this.calcAdjustStrategy=function(energyAdj){};this.consSumMonth=function(source,month){for(var i in Unit.co2){this.i+=source.i*month}this.co2+=source.co2*month;this.cost+=source.cost*month};this.calcMeasure=function(){};this.calcMeasureInit=function(){for(var mes in this.measures){this.measures[mes].setzero()}};this.addReductionMargin=function(margin,originalConsName,sourceConsName){var ccons;var pcons;var fromPart;this.add(margin);this.calcCO2();this.calcCost();this.calcJules();if(sourceConsName==""){sourceConsName=originalConsName}if(this.sumConsName!=sourceConsName&&this.sumConsName!=originalConsName){ccons=this.sumCons;if(ccons){if(ccons[this.subID]){ccons[this.subID].addReductionMargin(margin,originalConsName,this.consName)}else{ccons.addReductionMargin(margin,originalConsName,this.consName)}}}if(this.sumCons2Name!=""&&this.sumCons2Name!=sourceConsName&&this.sumCons2Name!=originalConsName){ccons=this.sumCons2;if(ccons){if(ccons[this.subID]){ccons[this.subID].addReductionMargin(margin,originalConsName,this.consName)}else{ccons.addReductionMargin(margin,originalConsName,this.consName)}}}if(this.consCode!="TO"){fromPart=false;for(pcons in this.partCons){if(this.partCons[pcons].consName==sourceConsName||this.partCons[pcons].consName==originalConsName){fromPart=true}}if(!fromPart&&this.partCons.length>0){this.addReductionMargin2Part(this.partCons,margin,originalConsName,this.consName)}fromPart=false;for(pcons in this.partCons2){if(this.partCons2[pcons].consName==sourceConsName||this.partCons2[pcons].consName==originalConsName){fromPart=true}}if(!fromPart&&this.partCons2.length>0){this.addReductionMargin2Part(this.partCons2,margin,originalConsName,this.consName)}}};this.addReductionMargin2Part=function(pconsList,margin,originalConsName,sourceConsName){var submargin=D6.object(D6.Energy);var pcons;if(pconsList.length>1){var sumCo2=0;for(pcons in pconsList){if(!isNaN(pconsList[pcons].co2)){sumCo2+=pconsList[pcons].co2}}if(pconsList[0].orgCopyNum>=1&&pconsList[0].subID!=pconsList[1].subID){for(pcons in pconsList){if(pconsList[pcons].co2>0){submargin.copy(margin);submargin.multiply(pconsList[pcons].co2/sumCo2);pconsList[pcons].addReductionMargin(submargin,originalConsName,this.consName)}}}else{for(pcons in pconsList){if(pconsList[pcons].co2>0){if(pconsList[pcons].consAddSet){for(pmes in this.measures){var mes=this.measures[pmes];if(mes.selected&&mes[pconsList[pcons].consName]){submargin.copy(mes[pconsList[pcons].consName]);submargin.sub(pconsList[pcons]);pconsList[pcons].addReductionMargin(submargin,originalConsName,this.consName)}}}else{submargin.copy(margin);submargin.multiply(pconsList[pcons].co2/sumCo2);pconsList[pcons].addReductionMargin(submargin,originalConsName,this.consName)}}}}}};this.input=function(InDataCode,defaultData){var ret;if(D6.averageMode){if(D6.scenario.defCalcAverage.indexOf(InDataCode)==-1){return defaultData}}var InData=D6.doc.data[InDataCode];if(typeof InData==="undefined"||InData==-1||InData===""){ret=defaultData}else{ret=InData;if(D6.scenario.defInput[InDataCode.substr(0,4)].varType=="Number"){ret=parseFloat(ret)}}return ret};this.getEquipParameters=function(year,size,sizeThreshold,defEquip){var ret={};var sizeCode=sizeThreshold[0];for(var sizeTmp in sizeThreshold){if(size>sizeThreshold[sizeTmp]*1.001){continue}else{sizeCode=sizeThreshold[sizeTmp];break}}var defs=defEquip[sizeCode];var justbefore=-9999;var justafter=99999;for(var defone in defs){if(year<=defone){if(defone<justafter)justafter=defone}else{if(defone>justbefore)justbefore=defone}}for(var parameters in defs[justbefore]){ret[parameters]=((justafter-year)*defs[justbefore][parameters]+(year-justbefore)*defs[justafter][parameters])/(justafter-justbefore)}return ret};this.setsubID=function(num){this.subID=num;if(this.titleList){this.title=this.titleList[num]}};this.isSelected=function(mName){if(!this.measures[mName]){return false}else{return this.measures[mName].selected}};this.getIndex=function(val,thresholdList){for(var i=0;i<thresholdList.length;i++){if(val<thresholdList[i]){return i}}return thresholdList.length}};D6.ConsBase.init();D6.MeasureBase=D6.object(D6.Energy);D6.MeasureBase.init=function(){this.mesID=0;this.mesdefID=0;this.subID=0;this.groupID=0;this.measureName="";this.cons="";this.selected=false;this.available=false;this.reduceRate=0;this.title="";this.titleShort="";this.priceNew=0;this.priceOrg=0;this.lifeTime=0;this.lifestyle=2;this.def="";this.costUnique;this.co2Change=0;this.co2ChangeW1=0;this.co2ChangeW2=0;this.costOtherChange=0;this.costChange=0;this.costTotalChange=0;this.payBackYear=0;this.co2ChangeOriginal=0;this.costOriginal=0;this.costChangeOriginal=0;this.costTotalChangeOriginal=0;this.co2ChangeSumup=0;this.costSumup=0;this.costChangeSumup=0;this.costTotalChangeSumup=0;this.advice="";this.joyfull="";this.figNum=0;this.hojoGov=0;this.genzeiGov=0;this.hojoInfo=""};D6.MeasureBase.init();D6.MeasureBase.Constructor=function(consInstance,mdef,mesIDP){this.def=mdef;this.measureName=mdef["name"];this.cons=consInstance;this.mesID=mesIDP;this.mesdefID=mdef["mid"];this.title=mdef["title"];this.titleShort=mdef["titleShort"];this.lifeTime=mdef["lifeTime"];this.priceOrg=mdef["price"];this.groupID=this.cons.groupID;this.lifestyle=mdef["lifestyle"];this.advice=mdef["advice"];this.joyfull=mdef["joyfull"];this.figNum=mdef["figNum"]};D6.MeasureBase.clearMeasure=function(){this.priceNew=0;this.lifeTime=0;this.co2Change=0;this.co2ChangeW1=0;this.co2ChangeW2=0;this.costChange=0;this.payBackYear=0;this.costOtherChange=0;this.costTotalChange=0;this.co2ChangeSumup=0;this.costChangeSumup=0;this.costTotalChangeSumup=0;this.available=false;this.costUnique=0;this.priceOrg=0;this.clear()};D6.MeasureBase.calcSave=function(){this.calcCO2();this.co2Change=this.co2-this.cons.co2;this.co2ChangeW1=this.co2Change*this.def.easyness*(this.def.lifestyle==1?2:1);this.co2ChangeW2=this.co2Change*this.def.easyness*this.def.easyness*(this.def.lifestyle==1?3:1);if(this.costUnique!=0&&!isNaN(this.costUnique)){this.cost=this.costUnique}else{this.calcCost()}this.costChange=(this.cost==0?0:this.cost-this.cons.cost);if(this.def.easyness<0){this.co2Change=0;this.costChange=0}if(this.priceNew==0)this.priceNew=this.priceOrg;if(this.priceNew>=0&&this.lifeTime>0){this.costTotalChange=this.costChangeOriginal+this.priceNew/this.lifeTime/12;if(this.costChangeOriginal>0){this.payBackYear=999}else{this.payBackYear=Math.min(Math.round(-this.priceNew/this.costChangeOriginal/12),999)}}else{this.costTotalChange=this.costChange}if(D6.isOriginal){this.co2ChangeOriginal=this.co2Change;this.costChangeOriginal=this.costChange;this.costTotalChangeOriginal=this.costTotalChange;this.co2ChangeW1Original=this.co2ChangeW1;this.co2ChangeW2Original=this.co2ChangeW2}};D6.MeasureBase.setzero=function(){this.copy(this.cons)};D6.MeasureBase.calcReduceRate=function(reduceRate){this.copy(this.cons);this.multiply(1-reduceRate)};D6.MeasureBase.calcReduceRateOne=function(target,reduceRate){this[target]=this.cons[target];this.multiply(1-reduceRate)};D6.MeasureBase.calcReduceRateWithParts=function(reduceRate,partCons){this.calcReduceRate(reduceRate);for(var c in partCons){this[partCons[c].consName]=D6.object(D6.Energy);this[partCons[c].consName].copy(partCons[c]);this[partCons[c].consName].multiply(1-reduceRate)}};D6.MeasureBase.addReduction=function(){var margin=D6.object(D6.Energy);margin.copy(this);margin.sub(this.cons);this.cons.addReductionMargin(margin,this.cons.consName)};D6.MeasureBase.calc=function(){this.clearMeasure();cons.calcMeasure(this.measureName);this.calcSave()};D6.MeasureBase.measureSumMonth=function(source,month){for(var i in Unit.co2){this[i]+=source[i]*month}this.co2+=source.co2*month;this.co2Change+=source.co2Change*month;this.co2ChangeOriginal+=source.co2ChangeOriginal*month;this.cost+=source.cost*month;this.costChange+=source.costChange*month;this.costTotalChange+=source.costTotalChange*month;this.costOriginal+=source.costOriginal*month;this.costChangeOriginal+=source.costChangeOriginal*month;this.costTotalChangeOriginal+=source.costTotalChangeOriginal*month};D6.doc={data:[],equip:[],clear:function(dialog){var answer;var AreaOrgBackup;if(dialog){if(answer=="CANCEL"){return}}AreaOrgBackup=this.data["AreaOrg"];this.data=new Array();this.data["AreaOrg"]=AreaOrgBackup;this.data["Area"]=AreaOrgBackup},serialize:function(){var saveData="";var temp="";var prop=0;var i=0;var Input=this.data;for(prop in Input){if(D6.scenario.defInput[prop.substr(0,4)].defaultValue==Input[prop])continue;temp=""+Input[prop];if(typeof(Input[prop])=="string"){while(temp.indexOf(" ")!=-1){i=temp.indexOf(" ");temp=temp.substring(0,i-1)+"_"+temp.substring(i+1,2000)}while(temp.indexOf(",")!=-1){i=temp.indexOf(",");temp=temp.substring(0,i-1)+"~"+temp.substring(i+1,2000)}}saveData=saveData+prop+"="+temp+","}for(prop in D6.logicList){if(D6.logicList[prop].orgCopyNum>=1){saveData+=prop+"="+D6.logicList[prop].orgCopyNum+","}}var sel="";for(i=0;i<D6.measureList.length;i++){if(D6.measureList[i].selected){temp="000"+D6.measureList[i].mesdefID;tempg="00"+D6.measureList[i].subID;sel+=temp.substr(-3)+tempg.substr(-2);tempi="00000000"+D6.measureList[i].priceNew;sel+=tempi.substr(-8);if(D6.measureList[i].costChangeOriginal>0){sel+="9"}else{sel+="8"}temp="0000000"+Math.abs(Math.round(D6.measureList[i].costChangeOriginal));sel+=temp.substr(-7);if(D6.measureList[i].co2ChangeOriginal>0){sel+="9"}else{sel+="8"}temp="00000"+Math.abs(Math.round(D6.measureList[i].co2ChangeOriginal));sel+=temp.substr(-5)}}saveData+="mesSelId="+sel;return saveData},loadDataSet:function(loadData,addflag){var param;var paramOne;var val;var vname;var vnameDef;var i;var j;var prop;var mesSel;var Input=this.data;var indef=D6.scenario.defInput;var mesid=0;var subid=0;param=loadData.split(",");for(i=0;i<param.length;i++){if(param[i]){paramOne=param[i].split("=");vname=paramOne[0];vnameDef=vname.substr(0,4);val=paramOne[1]}else{vname="dummy"}if(D6.logicList[vname]){if(parseInt(val)&&parseInt(val)<100){if(!addflag){D6.logicList[vname].orgCopyNum=parseInt(val)}}}else if(indef[vnameDef]){switch(indef[vnameDef].varType){case"Number":Input[vname]=parseFloat(val);break;case"String":j=val.indexOf("_");while(j!=-1){val=val.substring(0,j)+" "+val.substring(j+1,200);j=val.indexOf("_")}j=val.indexOf("~");while(j!=-1){val=val.substring(0,j)+","+val.substring(j+1,200);j=val.indexOf("~")}j=val.indexOf("\"");while(j!=-1){val=val.substring(0,j)+val.substring(j+1,200);j=val.indexOf("\"")}Input[vname]=val;break;default:if(vname=="mesSelId"){mesSel=val;for(j=0;j<mesSel.length;j+=27){mesid=parseInt(mesSel.substr(j,3));subid=parseInt(mesSel.substr(j+3,2));for(var k=0;k<D6.measureList.length;k++){if(D6.measureList[k].mesID==mesid&&D6.measureList[k].subID==subid){D6.measureList[k].seleted=true;break}}}}else{if(val=="true"){Input[vname]=true}else if(val=="false"){Input[vname]=false}}}}}return mesSel}};D6=D6||{};D6.calcMonthly=function(ave,season,monthly,seasonPatternP,energyCode){var month2season=[0,0,0,1,1,1,2,2,2,1,1,0];var seasonPatternCons=[0,0,0];var seasonPattern=[0,0,0];var seasonCount=[0,0,0];var seasonCons=[0,0,0];var monthlyCons=[];var i;var noConsData=true;var sumCons=0;var countCons=0;for(i=0;i<12;i++){if(monthly[i]!=-1){seasonPatternCons[month2season[i]]+=monthly[i];seasonCount[month2season[i]]++;sumCons+=monthly[i];countCons++;noConsData=false}}if(seasonCount[0]>0&&seasonCount[1]>0&&seasonCount[2]>0){seasonPattern[0]=seasonPatternCons[0]/seasonCount[0];seasonPattern[1]=seasonPatternCons[1]/seasonCount[1];seasonPattern[2]=seasonPatternCons[2]/seasonCount[2]}else if(season[0]!=-1&&season[1]!=-1&&season[2]!=-1){seasonPattern[0]=season[0];seasonPattern[1]=season[1];seasonPattern[2]=season[2]}else if(seasonPatternP){seasonPattern=seasonPatternP}else{seasonPattern=[1,1,1]}var sum=seasonPattern[0]*4+seasonPattern[1]*5+seasonPattern[2]*3;if(sum!=0){seasonPattern[0]*=12/sum;seasonPattern[1]*=12/sum;seasonPattern[2]*=12/sum}if(season[0]==-1&&season[1]==-1&&season[2]==-1){if(countCons>6){ave=D6.Unit.consToCost(sumCons/countCons,energyCode)}season[0]=ave*seasonPattern[0];season[1]=ave*seasonPattern[1];season[2]=ave*seasonPattern[2]}else{noConsData=false;var ave2=0;var ave2count=0;for(i=0;i<3;i++){if(seasonPattern[i]!=0){if(season[i]!=-1){ave2+=season[i]/seasonPattern[i];ave2count++}else if(seasonCount[i]>=1){season[i]=D6.Unit.consToCost(seasonPatternCons[i]/seasonCount[i],energyCode);ave2+=season[i]/seasonPattern[i];ave2count++}}else{ave2count++}}ave2/=ave2count;ave=ave2;season[0]=(season[0]==-1?ave*seasonPattern[0]:season[0]);season[1]=(season[1]==-1?ave*seasonPattern[1]:season[1]);season[2]=(season[2]==-1?ave*seasonPattern[2]:season[2])}seasonCons[0]=D6.Unit.costToCons(season[0],energyCode);seasonCons[1]=D6.Unit.costToCons(season[1],energyCode);seasonCons[2]=D6.Unit.costToCons(season[2],energyCode);for(i=0;i<12;i++){if(monthly[i]==-1){sim=month2season[(i+12-1)%12];si=month2season[i];sip=month2season[(i+1)%12];monthly[i]=(season[sim]+season[si]+season[sip])/3}}var ret=[];ret.ave=ave;ret.season=season;ret.seasonCons=seasonCons;ret.monthly=monthly;ret.noConsData=noConsData;return ret};var D6=D6||{};D6.getAllResult=function(consName){var ret=[];if(consName){if(!D6.logicList[consName])consName="consTotal";this.nowConsPageName=consName}consName=this.nowConsPageName;var consCode=D6.consListByName[consName][0].consCode;ret.common=D6.getCommonParameters();ret.monthly=this.getMonthly();ret.average=this.getAverage(consCode);ret.average_graph=this.getAverage_graph();ret.itemize=this.getItemize(consCode);ret.itemize_graph=this.getItemizeGraph(consCode);ret.measure=this.getMeasure(consName);return ret};D6.getAverage=function(consCode){var ret=[];ret.you=D6.consShow[consCode].co2Original*12;ret.after=D6.consShow[consCode].co2*12;ret.av=D6.average.consList[consCode].co2*12;ret.youc=D6.consShow[consCode].costOriginal*12;ret.afterc=D6.consShow[consCode].cost*12;ret.avc=D6.average.consList[consCode].cost*12;ret.rank100=D6.rankIn100(ret.you/ret.av);ret.afterrank100=D6.rankIn100(ret.after/ret.av);ret.samehome=D6.scenario.defSelectValue["sel021"][Math.max(1,D6.doc.data["i021"])];ret.sameoffice=D6.scenario.defSelectValue["sel001"][Math.max(1,D6.doc.data["i001"])];ret.consCode=consCode;return ret};D6.getAverage_graph=function(){var ret=[];ret.cost=[];ret.co2=[];ret.cost[1]=D6.area.averageCostEnergy;ret.co2[1]=D6.area.averageCO2Energy;ret.co2[1].total=ret.co2[1].electricity+ret.co2[1].gas+ret.co2[1].kerosene+ret.co2[1].car;ret.cost[0]=[];ret.cost[0].electricity=D6.consTotal.priceEle;ret.cost[0].gas=D6.consTotal.priceGas;ret.cost[0].kerosene=D6.consTotal.priceKeros;ret.cost[0].car=D6.consTotal.car*D6.Unit.price.gasoline;ret.co2[0]=[];ret.co2[0].electricity=D6.consTotal.electricity*D6.Unit.co2.electricity;ret.co2[0].gas=D6.consTotal.gas*D6.Unit.co2.gas;ret.co2[0].kerosene=D6.consTotal.kerosene*D6.Unit.co2.kerosene;ret.co2[0].car=D6.consTotal.car*D6.Unit.co2.gasoline;ret.co2[0].total=D6.consTotal.co2Original;return ret};D6.getItemize=function(consCode){var ret=[];var cons;var i=0;for(var cid in D6.consList){cons=D6.consList[cid];ret[i]=[];ret[i].title=cons.title;ret[i].consName=cons.consName;ret[i].subID=cons.subID;ret[i].sumConsName=cons.sumConsName;ret[i].sumCons2Name=cons.sumCons2Name;ret[i].countCall=cons.countCall;ret[i].co2=cons.co2;ret[i].co2Total=D6.consShow["TO"].co2;ret[i].electricity=cons.electricity;ret[i].nightelectricity=cons.nightelectricity;ret[i].gas=cons.gas;ret[i].water=cons.water;ret[i].coal=cons.coal;ret[i].hotwater=cons.hotwater;ret[i].kerosene=cons.kerosene;ret[i].car=cons.car;ret[i].color=cons.color;i++}return ret};D6.getItemizeGraph=function(consCode,sort){var otherCaption="other";if(consCode){this.nowConsCode=consCode}consCode=this.nowConsCode;if(sort){this.nowSortTarget=sort}sort=this.nowSortTarget;var menu={co2:{sort:"co2",title:"kg",round:1,divide:1},energy:{sort:"jules",title:"GJ",round:1,divide:1000},money:{sort:"cost",title:"yen",round:10,divide:1},};var show=menu[(sort?sort:"co2")];var ret=[];var gdata=function(target,scenario,original,consCode){var sorttarget=show.sort;if(original)sorttarget+="Original";var sum=0;var data=[];var di=0;if(consCode=="TO"){for(var cid in target){if(cid=="TO")continue;data[di]={};data[di]["compare"]=scenario;data[di]["ratio"]=Math.round(target[cid][sorttarget]/target[consCode][sorttarget]*1000)/10;data[di][show.title]=Math.round(target[cid][sorttarget]*12/show.divide*show.round)/show.round;data[di]["item"]=target[cid].title;di++;sum+=target[cid][sorttarget]}data[di]={};data[di]["compare"]=scenario;data[di]["ratio"]=Math.round((target["TO"][sorttarget]-sum)/target["TO"][sorttarget]*1000)/10;data[di][show.title]=Math.round((target["TO"][sorttarget]-sum)*12/show.divide*show.round)/show.round;data[di]["item"]=otherCaption}else{if(target[consCode].partCons){var target2=target[consCode].partCons;for(var cid in target2){data[di]={};data[di]["compare"]=scenario;data[di]["ratio"]=Math.round(target2[cid][sorttarget]/target[consCode][sorttarget]*1000)/10;data[di][show.title]=Math.round(target2[cid][sorttarget]*12/show.divide*show.round)/show.round;data[di]["item"]=target2[cid].title+(target2[cid].subID>0?":"+(D6.viewparam.countfix_pre_after==1?target2[cid].countCall+target2[cid].subID:target2[cid].subID+target2[cid].countCall):"");di++;sum+=target2[cid][sorttarget]}data[di]={};data[di]["compare"]=scenario;data[di]["ratio"]=Math.round((target[consCode][sorttarget]-sum)/target[consCode][sorttarget]*1000)/10;data[di][show.title]=Math.round((target[consCode][sorttarget]-sum)*12/show.divide*show.round)/show.round;data[di]["item"]=otherCaption}else{data[di]={};data[di]["compare"]=scenario;data[di]["ratio"]=1000/10;data[di][show.title]=Math.round(target[consCode][sorttarget]*12/show.divide*show.round)/show.round;data[di]["item"]=target[consCode].title;di++}}return data};var captions=["you","after","average"];var averageCaption="";if(D6.targetMode==1){averageCaption=D6.scenario.defSelectValue["sel021"][D6.area.area]}else{averageCaption=D6.scenario.defSelectValue["sel001"][Math.max(1,D6.doc.data["i001"])]}var data=gdata(D6.consShow,captions[0],true,consCode);Array.prototype.push.apply(data,gdata(D6.consShow,captions[1],false,consCode));Array.prototype.push.apply(data,gdata(D6.average.consList,captions[2],false,consCode));var clist=[];for(var cid in D6.consShow){if(cid=="TO")continue;if(consCode=="TO"||cid==consCode){clist.push({title:D6.consShow[cid].title,target:D6.consShow[cid][show.sort+"Original"],color:D6.consShow[cid].color})}}var ord=[];if(consCode=="TO"){D6.ObjArraySort(clist,"target","desc");for(var cid in clist){ord.push(clist[cid].title)}ord.push(otherCaption)}else{ord.push(clist.title)}ret.data=data;ret.yaxis=show.title;ret.ord=ord;ret.clist=clist;ret.averageCaption=averageCaption;ret.captions=captions;ret.consTitle=D6.consShow[consCode].title;return ret};D6.dataItemize=function(){var consShow=D6.consShow;var cons_temp=new Array();var cons_rebuild=new Array();var ci;for(ci in consShow){if(consShow[ci].consCode!="TO"){cons_temp.push(consShow[ci])}}var NUMERIC=16;var DESCENDING=2;cons_temp.sortOn("co2",NUMERIC|DESCENDING);cons_temp.unshift(consShow["TO"]);return cons_temp};D6.getMonthly=function(){var ret=[];var menu={co2:{sort:"co2",title:"kg",round:1,divide:1},energy:{sort:"jules",title:"MJ",round:1,divide:1000},money:{sort:"cost",title:"yen",round:1,divide:1},};var show=menu["money"];var ene1=[{r:0,ene:"electricity",name:D6.Unit.name["electricity"]},{r:1,ene:"gas",name:D6.Unit.name["gas"]},{r:2,ene:"kerosene",name:D6.Unit.name["kerosene"]},{r:3,ene:"coal",name:D6.Unit.name["coal"]},{r:4,ene:"hotwater",name:D6.Unit.name["hotwater"]},{r:5,ene:"car",name:D6.Unit.name["car"]}];var ene2=[];var month=[];var ri=0;var e;for(var m=1;m<=12;m++){for(e=0;e<ene1.length;e++){if(!D6.consShow["TO"].monthlyPrice[ene1[e].ene])continue;month[ri]=[];month[ri]["month"]=m;month[ri][show.title]=Math.round(D6.consShow["TO"].monthlyPrice[ene1[e].ene][m-1]/show.divide*show.round)/show.round;month[ri]["energyname"]=ene1[e].ene;ri++}}ret.data=month;ret.yaxis=show.title;return ret};D6.getGid=function(consName){return D6.logicList[consName].groupID};D6.getCommonParameters=function(){var ret=[];ret.co2Original=D6.consListByName["consTotal"][0].co2Original;ret.co2=D6.consListByName["consTotal"][0].co2;ret.costOriginal=D6.consListByName["consTotal"][0].costOriginal;ret.cost=D6.consListByName["consTotal"][0].cost;return ret};var D6=D6||{};D6.getEvaluateAxisPoint=function(target,inpListDefCode){var retall={};retall[0]=[0,"",""];retall[1]=[0,"",""];retall[2]=[0,"",""];var def=[];for(var d in D6.scenario.defEasyQues){if(D6.scenario.defEasyQues[d].cname==inpListDefCode){def=D6.scenario.defEasyQues[d].ques;break}}if(def=="")return retall;for(var i=0;i<3;i++){var pointfull=0;var point=0;var maxpoint=0;var maxname="";var minpoint=0;var minname="";var tmax=0;var defaultvalue=0;var thispoint=0;for(var incode in def){var weight=D6.scenario.defInput[def[incode]];var ans=D6.doc.data[def[incode]];var weightone=weight["d"+(i+1)+"w"];if(weightone=="")continue;defaultvalue=weight["d"+(i+1)+"d"]*weightone;if(ans==weight.defaultValue||ans===undefined){continue}pointfull+=weightone*2;if(ans>=weight["d"+(i+1)+"1t"]){thispoint=weight["d"+(i+1)+"1p"]*weightone}else if(weight["d"+(i+1)+"2t"]!=""&&ans>=weight["d"+(i+1)+"2t"]){thispoint=weight["d"+(i+1)+"2p"]*weightone}else if(weight["d"+(i+1)+"3t"]!=""&&ans>=weight["d"+(i+1)+"3t"]){thispoint=weight["d"+(i+1)+"3p"]*weightone}else{thispoint=0}if(maxpoint<thispoint){maxpoint=thispoint;maxname=weight.title}if(minpoint>thispoint-weightone*2){minpoint=thispoint-weightone*2;minname=weight.title}point+=thispoint}retall[i][0]=point/(pointfull==0?1:pointfull)*100;retall[i][1]=maxname;retall[i][2]=minname}return retall};D6.getInputPage=function(consName,subName){var ret=[];var group=[];var groupAddable=[];var subgroup=[];var subguide=[];var combos=[];var definp;var pagename;var subid=0;var subcode="";var cons="";var addlist=[];for(var c in D6.scenario.defEasyQues){var q=D6.scenario.defEasyQues[c];subcode=q.cname;group[q.cname]=q.title;groupAddable[q.cname]=[];addlist[q.cname]=[];subgroup[q.cname]=[];subguide[q.cname]=[];combos[q.cname]=[];subguide[q.cname][subcode]=[];combos[q.cname][subcode]=[];for(var i in q.ques){definp=D6.scenario.defInput[q.ques[i]];if(!definp&&D6.debugMode)console.log("defEasyQues error no "+q.ques[i]+" in scenarioset");subgroup[q.cname][subcode]=q.title;if(definp.varType=="String"){combos[q.cname][subcode].push(this.createTextArea(q.ques[i]))}else{combos[q.cname][subcode].push(this.createComboBox(q.ques[i]))}}}for(var c in D6.consShow){var cname=D6.consShow[c].consName;group[cname]=D6.consShow[c].title;groupAddable[cname]=[];addlist[cname]=[];subgroup[cname]=[];subguide[cname]=[];combos[cname]={};for(var i in D6.doc.data){definp=D6.scenario.defInput[i.substr(0,4)];cons=D6.logicList[definp.cons];if(cons.consName==cname||(cons.sumConsName==cname&&cons.sumConsName!="consTotal")||(cons.sumCons2Name==cname&&cons.sumCons2Name!="consTotal")||cons.inputDisp==cname){if(i.length==4){subid=0;subcode=cons.consName}else{subid=i.substr(4,2);if(subid==0)continue;subcode=cons.consName+subid}if(subgroup[cname][subcode]==undefined){if(subid==0){subgroup[cname][subcode]=cons.title}else{if(D6.viewparam.countfix_pre_after==1){subgroup[cname][subcode]=cons.countCall+(cons.titleList?cons.titleList[subid]:subid)}else{subgroup[cname][subcode]=(cons.titleList?cons.titleList[subid]:subid)+cons.countCall}}subguide[cname][subcode]=cons.inputGuide;combos[cname][subcode]=[]}if(cons.addable){if(addlist[cname].indexOf(cons.consName)<0){addlist[cname].push(cons.consName);groupAddable[cname].push({"consName":cons.consName,"caption":cons.addable})}}if(consName!=cname)continue;if(definp.varType=="String"){combos[cname][subcode].push(this.createTextArea(i))}else{combos[cname][subcode].push(this.createComboBox(i))}}}}ret.group=group;ret.groupAddable=groupAddable;ret.subgroup=subgroup;ret.subguide=subguide;ret.combos=combos;ret.consName=consName;if(!D6.logicList[consName])consName="consTotal";ret.title=D6.logicList[consName].title;ret.subName=subName;return ret};D6.createComboBox=function(inpId,onlyCombo){var disp="";var selid="sel"+inpId.substr(1,3);var inpIdDef=inpId.substr(0,4);var svalue=D6.scenario.defSelectValue[selid];var sdata=D6.scenario.defSelectData[selid];if(!sdata||sdata[0]==""){return this.createTextArea(inpId,onlyCombo)}var smax=svalue.length;var sel=D6.doc.data[inpId];var selectedclass=(sel!=-1)?" class='written' ":"";var title=D6.scenario.defInput[inpIdDef].title;if(title==""||title.substr(0,1)=="#")return"";if(!onlyCombo){disp+="<tr><td class='qtitle' width='50%'>";disp+=title;disp+="<div class='tool-tips'>"+D6.scenario.defInput[inpIdDef].text+(D6.debugMode?" "+inpId:"")+"</div>";disp+="</td><td>"}disp+="<select title='"+D6.scenario.defInput[inpIdDef].title+"' name='"+inpId+"' id='"+inpId+"'";disp+=" onchange='inchange(\""+inpId+"\");'";disp+=selectedclass;disp+=" >";for(var i=0;i<smax;i++){if(svalue[i]){disp+="<option value='"+sdata[i]+"' ";if(sdata[i]==sel)disp+="selected ";disp+=">"+(D6.debugMode?sdata[i]+" ":"")+svalue[i]+"</option>"}}disp+="</select>";if(!onlyCombo){disp+="</td></tr>"}return disp};D6.createTextArea=function(inpId,onlyCombo){var disp="";var selid="sel"+inpId.substr(1,3);var inpIdDef=inpId.substr(0,4);var val=D6.doc.data[inpId];var selectedclass=(val!=""&&val!=-1)?" class='written' ":"";var alignright=(D6.scenario.defInput[inpIdDef].varType=="Number");if(!onlyCombo){disp+="<tr><td class='qtitle'>";disp+=D6.scenario.defInput[inpIdDef].title;disp+="<div class='tool-tips' >"+D6.scenario.defInput[inpIdDef].text+(D6.debugMode?" "+inpId:"")+"</div>";disp+="</td><td>"}disp+="<input type='text' title='"+D6.scenario.defInput[inpIdDef].title+"' name='"+inpId+"' id='"+inpId+"' "+selectedclass+(alignright?"style='text-align:right;'":"")+" onchange='inchange(\""+inpId+"\");'"+(val&&val!=-1?" value='"+this.escapeHtml(val)+"'":"")+">";if(!onlyCombo){disp+=D6.scenario.defInput[inpIdDef].unit+"</td></tr>"}return disp};D6.tfHandlerCombo=function(name){return function(e){Input[name]=e.target.value;e.target.removeEventListener(Event.ENTER_FRAME,arguments.callee)}};D6.nowQuesCode=0;D6.nowQuesID=-1;D6.quesOrder=[];D6.getFirstQues=function(consName,subName){var definp;var cons;quesOrder=[];if(consName=="easy01"){if(Array.isArray(subName)){quesOrder=subName}else{quesOrder=D6.scenario.defQuesOrder}}else{for(var i in D6.doc.data){definp=D6.scenario.defInput[i.substr(0,4)];if(definp.cons==subName){quesOrder.push(i)}}}nowQuesID=0;nowQuesCode=quesOrder[nowQuesID];return this.getQues(nowQuesCode)};D6.getNextQues=function(){nowQuesID++;nowQuesCode=quesOrder[nowQuesID];return this.getQues(nowQuesCode)};D6.getPrevQues=function(){nowQuesID--;if(nowQuesID<0)nowQuesID=0;nowQuesCode=quesOrder[nowQuesID];return this.getQues(nowQuesCode)};D6.getQues=function(id){ret={};if(this.isEndOfQues()){ret.info="end"}else{ret.info="continue";ret.id=id;ret.numques=quesOrder.length;ret.nowques=nowQuesID+1;var def=D6.scenario.defInput[id.substr(0,4)];ret.title=def.title;ret.text=def.text;ret.unit=def.unit;var sel=def.inputType;ret.defSelectValue=D6.scenario.defSelectValue[sel];ret.defSelectData=D6.scenario.defSelectData[sel];ret.selected=D6.doc.data[id];ret.consTitle=D6.logicList[def.cons].title}return ret};D6.getQuesList=function(){var ret=[];ret.queslist=D6.doc.data;return ret};D6.isEndOfQues=function(){var ret=false;if(nowQuesID+1>quesOrder.length){ret=true}return ret};D6.escapeHtml=function(String){var escapeMap={'&':'&amp;',"'":'&#x27;','`':'&#x60;','"':'&quot;','<':'&lt;','>':'&gt;'};var escapeReg='[';var reg;for(var p in escapeMap){if(escapeMap.hasOwnProperty(p)){escapeReg+=p}}escapeReg+=']';reg=new RegExp(escapeReg,'g');return function escapeHtml(str){str=(str===null||str===undefined)?'':''+str;return str.replace(reg,function(match){return escapeMap[match]})}}(String);D6.getMeasureDetail=function(mesid){var ret=[];var mes=D6.measureList[mesid];ret.title=mes.title;ret.titleShort=mes.titleShort;ret.measureName=mes.measureName;ret.mesID=mes.mesID;ret.groupID=mes.groupID;ret.consName=mes.cons.consName;ret.figNum=mes.figNum;ret.advice=mes.advice;ret.joyfull=mes.joyfull;ret.total=mes.cons.total;ret.co2Total=D6.consShow["TO"].co2Original;ret.selected=mes.selected;ret.co2=mes.co2;ret.co2Change=mes.co2Change;ret.co2ChangeOriginal=mes.co2ChangeOriginal;ret.jules=mes.jules;ret.cost=mes.cost;ret.costChange=mes.costChange;ret.costChangeOriginal=mes.costChangeOriginal;ret.costTotalChange=mes.costTotalChange;ret.costTotalChangeOriginal=mes.costTotalChangeOriginal;ret.costUnique=mes.costUnique;ret.priceOrg=mes.priceOrg;ret.priceNew=mes.priceNew;ret.payBackYear=mes.payBackYear;ret.lifeTime=mes.lifeTime;ret.electricity=mes.electricity;ret.gas=mes.gas;ret.coal=mes.coal;ret.hotwater=mes.hotwater;ret.car=mes.car;ret.kerosene=mes.kerosene;ret.water=mes.water;return ret};D6.getMeasure=function(consName,maxPrice,notSelected){if(typeof maxPrice==='undefined')maxPrice=100000000;if(typeof notSelected==='undefined')notSelected=0;var ret=[];var i=0;var mes;var count=0;var mesidArray=[];for(var cid in D6.measureList){mesidArray.push(D6.measureList[cid])}D6.ObjArraySort(mesidArray,D6.sortTarget);for(var mid in mesidArray){cid=mesidArray[mid].mesID;mes=D6.measureList[cid];if(mes.title==""||mes.title.substr(0,1)=="#")continue;var partc=D6.consListByName[consName][0].partCons;var relation=false;for(var pc in partc){if(mes[partc[pc].consName])relation=true}if(mes[consName])relation=true;if(mes.selected&&notSelected==1)continue;if(mes.priceNew>maxPrice)continue;ret[i]=[];ret[i].mesID=mes.mesID;ret[i].title=mes.title;ret[i].selected=mes.selected;ret[i].consName=consName;ret[i].groupID=mes.groupID;ret[i].measureName=mes.measureName;ret[i].consconsName=mes.cons.consName;ret[i].conssumConsName=mes.cons.sumConsName;ret[i].conssumCons2Name=mes.cons.sumCons2Name;ret[i].co2Change=mes.co2Change;ret[i].co2ChangeOriginal=mes.co2ChangeOriginal;ret[i].costChangeOriginal=mes.costChangeOriginal;ret[i].conssubID=mes.cons.subID;ret[i].consmesTitlePrefix=mes.cons.mesTitlePrefix;ret[i].relation=relation;ret[i].payBackYear=mes.payBackYear;ret[i].lifeTime=mes.lifeTime;ret[i].lifestyle=mes.lifestyle;if(mes.cons.color||mes.cons.consName=="consTOTAL"){ret[i].color=mes.cons.color}else{ret[i].color=mes.cons.sumCons.color}i++}return ret};D6.getDemandGraph=function(){var work={};var retone={};var retall={};var clist=[];for(var c in D6.scenario.defInput){if(D6.scenario.defInput[c].demand>0){work[D6.scenario.defInput[c].cons]=[]}}for(var i in D6.doc.data){var definp=D6.scenario.defInput[i.substr(0,4)];if(work[definp.cons]){var count=parseInt(i.substr(4,2));if(!work[definp.cons][count])work[definp.cons][count]=[];work[definp.cons][count][definp.demand]=D6.doc.data[i]}}var ret=[];var ri=0;var ctitle="";var ctitle2="";var watt=0;var num=1;var st=0;var ed=24;var colorcount=0;var seriescolor="";for(c in work){colorcount++;ctitle=D6.logicList[c].addable;for(i in work[c]){if(work[c][i][4]){ctitle2=work[c][i][4]}else{ctitle2=i}if(work[c][i][1]&&work[c][i][1]>0){watt=work[c][i][1]}else if(work[c][i][2]&&work[c][i][2]>0){watt=work[c][i][2]/1000}else{watt=0}if(work[c][i][3]&&work[c][i][3]>0){num=work[c][i][3]}else{num=0}if(work[c][i][5]&&work[c][i][5]>=0){st=work[c][i][5]}else{st=0}if(work[c][i][6]&&work[c][i][6]>=0){ed=work[c][i][6]}else{ed=24}if(watt*num==0)continue;if(st>=ed)continue;seriescolor=graphColorSeries(colorcount);for(var t=0;t<24;t++){ret[ri]={};ret[ri]["equip"]=ctitle+"-"+(parseInt(ctitle2)?i:ctitle2);ret[ri]["time"]=t;if(t>=st&&t<ed){ret[ri]["electricity_kW"]=Math.round(watt*num*10)/10}else{ret[ri]["electricity_kW"]=0}clist.push({title:ret[ri]["equip"],target:"electricity_kW",color:seriescolor});ri++}}}retall.sumup=ret;retall.clist=clist;var log=[];for(var t=0;t<24;t++){log[t]={};log[t]["equip"]="log";log[t]["time"]=t;log[t]["electricity_kW"]=D6.doc.data["i056"+(t+1)]}retall.log=log;return retall;function graphColorSeries(colid){var color;var col=[100,100,100];if(colid<=3){col[colid-1]=255}else if(colid<=6){col[colid-4]=0}for(var c in col){if(col[c]==100){col[c]=Math.floor(Math.random()*150)+38}}color="#"+(col[0]*256*256+col[1]*256+col[2]).toString(16);return color}};D6.getInputDemandSumup=function(){var work={};var ret={};var title={};var pdata={};var demandone={};var combos=[];for(var c in D6.scenario.defInput){if(D6.scenario.defInput[c].demand>0){work[D6.scenario.defInput[c].cons]=true;ret[D6.scenario.defInput[c].cons]={}}}var inhtml="";for(var i in D6.doc.data){var definp=D6.scenario.defInput[i.substr(0,4)];if(work[definp.cons]){inhtml=this.createComboBox(i,true);var count=parseInt(i.substr(4,2));title[definp.cons]=D6.consListByName[definp.cons][0].addable;if(!ret[definp.cons][count])ret[definp.cons][count]=[];ret[definp.cons][count][definp.demand]=inhtml}}pdata.data=ret;pdata.title=title;return pdata};D6.getInputDemandLog=function(){var ret=[];for(var t=0;t<24;t++){ret[t]=this.createComboBox("i056"+(t+1),true)}return ret};﻿D6.scenario={defCons:[],defMeasures:[],defEquipment:[],defEquipmentSize:[],defInput:[],defSelectValue:[],defSelectData:[],defQuesOrder:[],getLogicList:function(){var logicList=new Array();logicList["consTotal"]=D6.consTotal;logicList["consEnergy"]=D6.consEnergy;logicList["consSeason"]=D6.consSeason;logicList["consHWsum"]=D6.consHWsum;logicList["consHWshower"]=D6.consHWshower;logicList["consHWtub"]=D6.consHWtub;logicList["consHWdresser"]=D6.consHWdresser;logicList["consHWdishwash"]=D6.consHWdishwash;logicList["consHWtoilet"]=D6.consHWtoilet;logicList["consCOsum"]=D6.consCOsum;logicList["consACcool"]=D6.consACcool;logicList["consHTsum"]=D6.consHTsum;logicList["consHTcold"]=D6.consHTcold;logicList["consACheat"]=D6.consACheat;logicList["consAC"]=D6.consAC;logicList["consRFsum"]=D6.consRFsum;logicList["consRF"]=D6.consRF;logicList["consLIsum"]=D6.consLIsum;logicList['consLI']=D6.consLI;logicList["consTVsum"]=D6.consTVsum;logicList["consTV"]=D6.consTV;logicList["consDRsum"]=D6.consDRsum;logicList["consCRsum"]=D6.consCRsum;logicList["consCR"]=D6.consCR;logicList["consCRtrip"]=D6.consCRtrip;logicList["consCKpot"]=D6.consCKpot;logicList["consCKcook"]=D6.consCKcook;logicList["consCKrice"]=D6.consCKrice;logicList["consCKsum"]=D6.consCKsum;return logicList},setDefs:function(){var defMeasures=[];var defInput=[];var defSelectValue=[];var defSelectData=[];var defQuesOrder=[];var defEquipment=[];var defEquipmentSize=[];defSelectValue['sel021']=["select","hokkaido"];defSelectData['sel021']=['-1','1'];defSelectValue['sel022']=["select","north","south"];defSelectData['sel022']=["-1","1","2"];this.defCalcAverage=["i001","i005","i021"];this.measuresSortChange="i010";this.measuresSortTarget=["co2ChangeOriginal","co2ChangeOriginal","costTotalChangeOriginal","co2ChangeW1Original","co2ChangeW2Original"];this.defEasyQues=[{title:"easy input",cname:"easy01",ques:['i021','i001','i002','i003','i051','i061','i063','i064','i075','i101','i103','i105','i116','i201','i202','i204','i205','i263','i501','i601','i701','i010']},{title:"Action Point",cname:"action01",ques:['i502','i501','i621','i601','i205','i041','i237','i263','i061','i003','i001','i105','i106','i116','i121','i421','i721','i821']}];this.defQuesOrder=['i010','i021','i001','i002','i003','i051','i061','i063','i064','i075','i101','i103','i105','i116','i201','i202','i204','i205','i263','i501','i601','i701'];this.defMeasures=defMeasures;this.defInput=defInput;this.defSelectValue=defSelectValue;this.defSelectData=defSelectData;this.defEquipment=defEquipment;this.defEquipmentSize=defEquipmentSize;D6.area.setCalcBaseParams=function(){D6.area.setPersonArea(D6.doc.data.i001,D6.doc.data.i021,D6.doc.data.i023)};D6.area.getSeasonParamCommon=function(){return D6.area.getSeasonParam(D6.area.area)}}};D6.consTotal=D6.object(D6.ConsBase);D6.consTotal.init=function(){this.consName="consTotal";this.consCode="TO";this.title="whole";this.orgCopyNum=0;this.groupID="9";this.color="#a9a9a9";this.countCall="";this.sumConsName="";this.sumCons2Name="";this.inputGuide="Basic information about the area and house";this.ratioNightEcocute=0.4;this.ratioNightHWElec=0.6;this.solarSaleRatio=0.6;this.generateEleUnit=1000;this.reduceHEMSRatio=0.1;this.standardSize=3.6;this.noConsData=true;this.averagePriceElec;this.seasonConsPattern=[1.4,1,1.2]};D6.consTotal.init();D6.consTotal.precalc=function(){this.clear();this.person=this.input("i001",3);this.solarSet=this.input("i051",0);this.solarKw=this.input("i052",this.solarSet*3.5);this.solarYear=this.input("i053",0);this.priceEle=this.input("i061",D6.area.averageCostEnergy.electricity);this.priceEleSpring=this.input("i0912",-1);this.priceEleSummer=this.input("i0913",-1);this.priceEleWinter=this.input("i0911",-1);this.priceEleSell=this.input("i062",0);this.priceGas=this.input("i063",D6.area.averageCostEnergy.gas);this.priceGasSpring=this.input("i0932",-1);this.priceGasSummer=this.input("i0933",-1);this.priceGasWinter=this.input("i0931",-1);this.houseType=this.input("i002",-1);this.houseSize=this.input("i003",(this.person==1?60:(80+this.person*10)));this.heatEquip=this.input("i202",-1);this.priceKerosSpring=this.input("i0942",-1);this.priceKerosSummer=this.input("i0943",-1);this.priceKerosWinter=this.input("i0941",-1);if(this.priceKerosWinter==-1){if(D6.area.averageCostEnergy.kerosene<1000){this.priceKeros=this.input("i064",0)}else{this.priceKeros=this.input("i064",D6.area.averageCostEnergy.kerosene/D6.area.seasonMonth.winter*12)}}this.priceCar=this.input("i075",D6.area.averageCostEnergy.car);this.equipHWType=this.input("i101",1);this.generateEleUnit=D6.area.unitPVElectricity;this.seasonPrice={electricity:[this.priceEleWinter,this.priceEleSpring,this.priceEleSummer],gas:[this.priceGasWinter,this.priceGasSpring,this.priceGasSummer],kerosene:[this.priceKeros,this.priceKerosSpring,this.priceKerosSummer],car:[-1,-1,-1]};this.monthlyPrice={electricity:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],gas:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],kerosene:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],car:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]};if(D6.area.averageCostEnergy.kerosene<1000){if(this.input("i063",-1)<0&&this.input("i0931",-1)<0&&this.input("i0932",-1)<0&&this.input("i0933",-1)<0){this.keros2gas=D6.area.averageCostEnergy.kerosene/D6.Unit.price.kerosene*D6.Unit.calorie.kerosene/D6.Unit.calorie.gas*D6.Unit.price.gas;this.priceGasSpring+=this.keros2gas;this.priceGasWinter+=this.keros2gas}}};D6.consTotal.calc=function(){var ret;var seasonConsPattern=D6.area.getSeasonParamCommon();ret=D6.calcMonthly(this.priceEle,this.seasonPrice["electricity"],this.monthlyPrice["electricity"],seasonConsPattern.electricity,"electricity");this.priceEle=ret.ave;this.seasonPrice["electricity"]=ret.season;this.monthlyPrice["electricity"]=ret.monthly;this.noConsData=ret.noConsData&&(this.input("i061",-1)==-1);if(this.equipHWType==5){this.averagePriceElec=this.ratioNightHWElec*D6.Unit.price.nightelectricity+(1-this.ratioNightHWElec)*D6.Unit.price.electricity;this.allDenka=true}else if(this.equipHWType==6){this.averagePriceElec=this.ratioNightEcocute*D6.Unit.price.nightelectricity+(1-this.ratioNightEcocute)*D6.Unit.price.electricity;this.allDenka=true}else{this.averagePriceElec=D6.Unit.price.electricity;this.allDenka=false}var priceBase;if(this.allDenka){priceBase=D6.Unit.price.nightelectricity}else{priceBase=0}var generateEle=this.generateEleUnit*this.solarKw/12;this.pvRestrict=1;if(D6.area.electCompany==2||D6.area.electCompany==3||D6.area.electCompany==5){this.pvRestrict=0}var pvSellUnitPrice=D6.Unit.price.sellelectricity;if(this.solarYear>1990&&this.solarYear<=2010){pvSellUnitPrice=48}else if(this.solarYear==2011||this.solarYear==2012){pvSellUnitPrice=42}else if(this.solarYear==2013){pvSellUnitPrice=38}else if(this.solarYear==2014){pvSellUnitPrice=37}else if(this.solarYear==2015){if(this.pvRestrict==1){pvSellUnitPrice=35}else{pvSellUnitPrice=33}}else if(this.solarYear==2016){if(this.pvRestrict==1){pvSellUnitPrice=33}else{pvSellUnitPrice=31}}else if(this.solarYear>=2017&&this.solarYear<2100){if(this.pvRestrict==1){pvSellUnitPrice=30}else{pvSellUnitPrice=28}}if(this.solarKw>0){this.grossElectricity=(1-this.solarSaleRatio)*generateEle+Math.max(0,(this.priceEle-this.priceEleSell+this.solarSaleRatio*generateEle*pvSellUnitPrice-priceBase))/this.averagePriceElec;this.electricity=this.grossElectricity-generateEle}else{this.electricity=(this.priceEle-priceBase)/this.averagePriceElec;this.grossElectricity=this.electricity}ret=D6.calcMonthly(this.priceGas,this.seasonPrice["gas"],this.monthlyPrice["gas"],seasonConsPattern.gas,"gas");this.priceGas=ret.ave;this.seasonPrice["gas"]=ret.season;this.monthlyPrice["gas"]=ret.monthly;this.gas=(this.priceGas-D6.Unit.priceBase.gas)/D6.Unit.price.gas;ret=D6.calcMonthly(this.priceKeros,this.seasonPrice["kerosene"],this.monthlyPrice["kerosene"],seasonConsPattern.kerosene,"kerosene");this.priceKeros=ret.ave;this.seasonPrice["kerosene"]=ret.season;this.monthlyPrice["kerosene"]=ret.monthly;if(this.heatEquip==4&&this.priceKeros<1000){this.priceKeros=2000}this.kerosene=this.priceKeros/D6.Unit.price.kerosene;ret=D6.calcMonthly(this.priceCar,this.seasonPrice["car"],this.monthlyPrice["car"],seasonConsPattern.car,"car");this.priceCar=ret.ave;this.seasonPrice["car"]=ret.season;this.monthlyPrice["car"]=ret.monthly;this.car=this.priceCar/D6.Unit.price.car};D6.consTotal.calcMeasure=function(){var mes;var solar_reduceVisualize=this.reduceHEMSRatio;if(this.pvRestrict==1){pvSellUnitPrice=30}else{pvSellUnitPrice=28}mes=this.measures["mTOsolar"];mes.copy(this);if(this.solarKw==0&&(this.houseType!=2)){var solar_generate_kWh=this.generateEleUnit*this.standardSize/12;var solar_priceDown=solar_generate_kWh*this.solarSaleRatio*pvSellUnitPrice+solar_generate_kWh*(1-this.solarSaleRatio)*D6.Unit.price.electricity;var solar_priceVisualize=this.electricity*solar_reduceVisualize*D6.Unit.price.electricity;mes.electricity=this.electricity*(1-solar_reduceVisualize)-solar_generate_kWh;mes.costUnique=this.cost-solar_priceDown-solar_priceVisualize;mes.priceNew=this.standardSize*mes.priceOrg;mes.advice=D6.scenario.defMeasures['mTOsolar']['advice']+"<br>("+this.standardSize+"kW)"}mes=this.measures["mTOhems"];mes.copy(this);if(!this.isSelected("mTOsolar")){mes.electricity=this.electricity*(1-this.reduceHEMSRatio)}mes=this.measures["mTOsolarSmall"];mes.copy(this);var watt_panel=50;var eff=0.3;mes.electricity-=watt_panel/1000*eff*this.generateEleUnit/12};﻿D6.consEnergy=D6.object(D6.ConsBase);D6.consEnergy.init=function(){this.consName="consEnergy";this.consCode="";this.title="General Energy Setting";this.orgCopyNum=0;this.groupID="0";this.color="#ff0000";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="the use of energy of the whole house, monthly bills";this.partConsName=[]};D6.consEnergy.init();D6.consEnergy.calc=function(){this.clear()};D6.consEnergy.calcMeasure=function(){};﻿D6.consSeason=D6.object(D6.ConsBase);D6.consSeason.init=function(){this.titleList=["","winter","spring/fall","summer"];this.consName="consSeason";this.consCode="";this.title="";this.orgCopyNum=3;this.groupID="2";this.color="#ff0000";this.countCall="";this.residueCalc="sumup";this.sumConsName="";this.sumCons2Name="consTotal";this.inputDisp="consTotal";this.inputGuide="For monthly water and electricity charges per season. Please fill in the approximate value."};D6.consSeason.init();D6.consSeason.calc=function(){this.clear()};D6.consSeason.calcMeasure=function(){};﻿D6.consHWsum=D6.object(D6.ConsBase);D6.consHWsum.init=function(){this.consName="consHWsum";this.consCode="HW";this.title="hot water supply";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="how to use hot water supply in general";this.hwEnergy=0;this.waterTemp=18;this.hotWaterTemp=42;this.tabWaterLitter=200;this.showerWaterLitterUnit=10;this.reduceRateShowerHead=0.3;this.showerWaterMinutes=5;this.otherWaterLitter=50;this.tankLossWatt=100;this.tabTemplatureDown=2;this.tabTemplatureInsulationDown=0.5;this.performanceGas=0.73;this.performanceEcojozu=0.877;this.performanceElec=0.8;this.performanceEcocute=3;this.performanceEnefarmEle=0.289;this.performanceEnefarmHW=0.33;this.performanceKeepWithTank=0.6;this.reduceRateSaveMode=0.2;this.reduceRateSolar=0.4;this.reduceRateSolarSystem=0.5;this.warmerElec_kWh_y=200;this.water_m3_d=0.1;this.reduceRateKeepStop};D6.consHWsum.init();D6.consHWsum.precalc=function(){this.clear();this.person=this.input("i001",3);this.housetype=this.input("i002",1);this.prefecture=this.input("i021",13);this.heatArea=D6.area.getHeatingLevel(this.prefecture);this.tabDayWeek=this.input("i103",(this.heatArea==1||this.heatArea==6?2:6));this.tabDayWeekSummer=this.input("i104",2);this.showerMinutes=this.input("i105",this.showerWaterMinutes*this.person);this.showerMinutesSummer=this.input("i106",this.showerWaterMinutes*this.person);this.savingShower=this.input("i116",-1);this.tabKeepHeatingTime=this.input("i108",(this.person>1?3:0));this.keepMethod=this.input("i110",5);this.tabInsulation=this.input("i117",-1);this.tabHeight=this.input("i107",8);this.equipType=this.input("i101",-1);this.priceGas=D6.consShow["TO"].priceGas;this.priceKeros=D6.consShow["TO"].priceKeros;this.dresserMonth=this.input("i114",4);this.dishWashMonth=this.input("i115",4);this.dishWashWater=this.input("i113",3);this.cookingFreq=this.input("i802",6);this.keepSeason=this.input("i131",2)};D6.consHWsum.calc=function(){if(this.equipType<=0){if(this.priceGas==0){if(this.priceKeros>3000){this.equipType=3}else{this.equipType=5}}else{this.equipType=1}}this.waterTemp=D6.area.getWaterTemplature();this.showerWaterLitter=(this.showerMinutes*(12-D6.area.seasonMonth.summer)+this.showerMinutesSummer*D6.area.seasonMonth.summer)/12*(this.savingShower==1?1-this.reduceRateShowerHead:1)*this.showerWaterLitterUnit;this.consHWtubLitter=this.tabWaterLitter*this.tabHeight/10*(this.tabDayWeek*(12-D6.area.seasonMonth.summer)+this.tabDayWeekSummer*D6.area.seasonMonth.summer)/12/7;this.allLitter=(this.consHWtubLitter+this.showerWaterLitter+this.otherWaterLitter);this.heatTapEnergy=this.allLitter*(this.hotWaterTemp-this.waterTemp)*365/12;this.tabKeepEnergy=this.consHWtubLitter*this.tabKeepHeatingTime*365/12*((this.tabInsulation==1||this.tabInsulation==2)?tabTemplatureInsulationDown:this.tabTemplatureDown)/((this.equipType==4||this.equipType==5)?this.performanceKeepWithTank:1)*this.keepMethod/10;this.heatEnergy=this.heatTapEnergy+this.tabKeepEnergy;this.hwEnergy=this.heatEnergy;this.consHWtubRate=this.consHWtubLitter/this.allLitter+(this.tabKeepEnergy/this.heatEnergy);this.consHWshowerRate=this.showerWaterLitter/this.allLitter*(this.heatTapEnergy/this.heatEnergy);this.consHWdresserRate=this.otherWaterLitter/2/ this.allLitter * ( this.heatTapEnergy /this.heatEnergy)*this.dresserMonth/6;this.consHWdishwashRate=this.otherWaterLitter/2/ this.allLitter * ( this.heatTapEnergy /this.heatEnergy)*(this.dishWashMonth==99?1:this.dishWashMonth/6)*(this.dishWashWater-1)/2*this.cookingFreq/6;this.tanklossEnergy=this.tankLossWatt/1000*D6.Unit.calorie.electricity*365/12;switch(this.equipType){case 1:this.mainSource="gas";this[this.mainSource]=this.heatEnergy/this.performanceGas/D6.Unit.calorie[this.mainSource];break;case 2:this.mainSource="gas";this[this.mainSource]=this.heatEnergy/this.performanceEcojozu/D6.Unit.calorie[this.mainSource];break;case 3:this.mainSource="kerosene";this[this.mainSource]=this.heatEnergy/this.performanceGas/D6.Unit.calorie[this.mainSource];break;case 4:this.mainSource="kerosene";this[this.mainSource]=this.heatEnergy/this.performanceEcojozu/D6.Unit.calorie[this.mainSource];break;case 5:this.mainSource="electricity";this[this.mainSource]=(this.heatEnergy+this.tanklossEnergy)/this.performanceElec/D6.Unit.calorie[this.mainSource];break;case 6:this.mainSource="electricity";this[this.mainSource]=(this.heatEnergy+this.tanklossEnergy)/this.performanceEcocute/D6.Unit.calorie[this.mainSource];break;case 7:case 8:default:this.mainSource="gas";this.gas=this.heatEnergy/this.performanceEcojozu/D6.Unit.calorie.gas}this.electricity+=this.warmerElec_kWh_y/12*(4-this.keepSeason)/3;this.water+=this.water_m3_d*this.person*30;this.reduceRateShowerTime=1/(this.showerMinutes/this.person-1)*this.consHWshowerRate;this.reduceRateTabKeep=this.tabKeepEnergy/(this.heatEnergy*this.consHWtubLitter/this.allLitter);this.reduceRateInsulation=((this.tabInsulation==1||this.tabInsulation==2)?0:this.reduceRateTabKeep*(this.tabTemplatureDown-this.tabTemplatureInsulationDown)/this.tabTemplatureDown);var ssummer=this.tabDayWeekSummer*D6.area.seasonMonth.summer;var snsummer=this.tabDayWeek*(12-D6.area.seasonMonth.summer);this.reduceRateStopTabSummer=ssummer/(ssummer+snsummer)};D6.consHWsum.calcMeasure=function(){var goodPerformance=false;if(this.isSelected("mHWecocute")||this.isSelected("mHWecofeel")||this.isSelected("mHWenefarm")){goodPerformance=true}var endEnergyNow=this.hwEnergy*this.co2/this.co2Original;if((this.equipType==-1||this.equipType==1||this.equipType==3||this.equipType==5)&&!goodPerformance){if(this.housetype==1){this.measures["mHWecocute"].clear();this.measures["mHWecocute"].nightelectricity=(endEnergyNow+this.tanklossEnergy)/this.performanceEcocute/D6.Unit.calorie.nightelectricity}if(this.equipType==3){this.measures["mHWecofeel"].clear();this.measures["mHWecofeel"].kerosene=endEnergyNow/this.performanceEcojozu/D6.Unit.calorie.kerosene}this.measures["mHWecojoze"].clear();this.measures["mHWecojoze"].gas=endEnergyNow/this.performanceEcojozu/D6.Unit.calorie.gas;if(this.housetype==1){this.measures["mHWenefarm"].clear();var notCoGenerationEnergy=500*1000/12; var coGenerationEnergy=endEnergyNow-notCoGenerationEnergy;this.measures["mHWenefarm"].gas=(coGenerationEnergy/this.performanceEnefarmHW+notCoGenerationEnergy/this.performanceEcojozu)/D6.Unit.calorie.gas;this.measures["mHWenefarm"].electricity=-coGenerationEnergy/this.performanceEnefarmHW*this.performanceEnefarmEle/D6.Unit.calorie.electricity}}if(this.equipType==6||this.equipType==5){this.measures["mHWsaveMode"].calcReduceRate(this.reduceRateSaveMode)}var rejectSolarSelect=false;if(this.isSelected("mHWecocute")||this.isSelected("mHWenefarm")||this.isSelected("mHWsolarSystem")||this.isSelected("mHWsolarHeater")){rejectSolarSelect=true}if(this.equipType!=5&&this.equipType!=6&&!rejectSolarSelect&&this.housetype==1){this.measures["mHWsolarHeater"].calcReduceRate(this.reduceRateSolar);this.measures["mHWsolarSystem"].calcReduceRate(this.reduceRateSolarSystem)}};D6.consHWsum.calcAdjustStrategy=function(energyAdj){this.heatEnergy*=energyAdj[this.mainSource];this.tanklossEnergy*=energyAdj[this.mainSource];this.hwEnergy*=energyAdj[this.mainSource]};﻿D6.consHWshower=D6.object(D6.ConsBase);D6.consHWshower.init=function(){this.consName="consHWshower";this.consCode="HW";this.title="shower";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consHWsum";this.sumCons2Name="";this.inputGuide="how to use shower"};D6.consHWshower.init();D6.consHWshower.calc=function(){this.copy(this.sumCons);this.multiply(this.sumCons.consHWshowerRate)};D6.consHWshower.calcMeasure=function(){if(this.sumCons.savingShower!=1){this.measures["mHWshowerHead"].calcReduceRate(this.sumCons.reduceRateShowerHead)}if(this.sumCons.showerMinutes/this.sumCons.person>=5&&!this.isSelected("mHWshowerTime30")){this.measures["mHWshowerTime"].calcReduceRate(this.sumCons.reduceRateShowerTime)}this.measures["mHWshowerTime30"].calcReduceRate(0.3)};﻿D6.consHWtub=D6.object(D6.ConsBase);D6.consHWtub.init=function(){this.autoKeepRate=0.5;this.consName="consHWtub";this.consCode="HW";this.title="Bathtub";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consHWsum";this.sumCons2Name="";this.inputGuide="how to use hot water in bath tub"};D6.consHWtub.init();D6.consHWtub.calc=function(){this.copy(this.sumCons);this.multiply(this.sumCons.consHWtubRate)};D6.consHWtub.calcMeasure=function(){this.measures["mHWinsulation"].calcReduceRate(this.sumCons.reduceRateInsulation);this.measures["mHWkeep"].calcReduceRate(this.sumCons.reduceRateTabKeep);if(this.sumCons.keepMethod>5){this.measures["mHWstopAutoKeep"].calcReduceRate(this.sumCons.reduceRateTabKeep*this.autoKeepRate)}this.measures["mHWonlyShower"].calcReduceRate(this.sumCons.reduceRateStopTabSummer)};﻿D6.consHWdresser=D6.object(D6.ConsBase);D6.consHWdresser.init=function(){this.consName="consHWdresser";this.consCode="HW";this.title="basin";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consHWsum";this.sumCons2Name="";this.inputGuide="How to wash hot water in the basin"};D6.consHWdresser.init();D6.consHWdresser.calc=function(){this.copy(this.sumCons);this.multiply(this.sumCons.consHWdresserRate)};D6.consHWdresser.calcMeasure=function(){};﻿D6.consHWdishwash=D6.object(D6.ConsBase);D6.consHWdishwash.init=function(){this.reduceRateWashTank=0.3;this.reduceRateWashNotSummer=0.5;this.reduceRateDishWasher=0.2;this.consName="consHWdishwash";this.consCode="HW";this.title="Dish Wash";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consHWsum";this.sumCons2Name="";this.inputGuide="How to use the dishwasher"};D6.consHWdishwash.init();D6.consHWdishwash.calc=function(){var sumcValue=this.sumCons.value;this.copy(this.sumCons);this.multiply(this.sumCons.consHWdishwashRate)};D6.consHWdishwash.calcMeasure=function(){if(this.sumCons.dishWashWater!=1){this.measures["mHWdishTank"].calcReduceRate(this.reduceRateWashTank)}if(this.sumCons.dishWashWater!=1){this.measures["mHWdishWater"].calcReduceRate(this.reduceRateWashNotSummer)}};﻿D6.consHWtoilet=D6.object(D6.ConsBase);D6.consHWtoilet.init=function(){this.warmerElec_kWh_y=200;this.resudeRateGoodSheat=0.5;this.resudeRateTemplature=0.2;this.resudeRateCover=0.1;this.water_m3_d=0.1;this.consName="consHWtoilet";this.consCode="HW";this.title="toilet";this.orgCopyNum=0;this.groupID="1";this.color="#ffb700";this.countCall="";this.sumConsName="consHWsum";this.sumCons2Name="";this.inputGuide="How to use toilet water and heat insulation"};D6.consHWtoilet.init();D6.consHWtoilet.precalc=function(){this.clear();this.person=this.input("i001",3);this.keepSeason=this.input("i131",2);this.savingToilet=this.input("i133",2)};D6.consHWtoilet.calc=function(){this.electricity=this.warmerElec_kWh_y/12*(4-this.keepSeason)/3;this.water=this.water_m3_d*this.person*30};D6.consHWtoilet.calcMeasure=function(){var mes;this.measures["mHWreplaceToilet5"].copy(this);this.measures["mHWreplaceToilet5"].water=this.water_m3_d*this.person*30/2;if(this.savingToilet!=1){this.measures["mHWreplaceToilet"].calcReduceRate(this.resudeRateGoodSheat)}if(!this.isSelected("mHWreplaceToilet")||this.savingToilet!=1){this.measures["mHWtemplatureToilet"].calcReduceRate(this.resudeRateTemplature)}if(!this.isSelected("mHWreplaceToilet")||this.savingToilet!=1){this.measures["mHWcoverTilet"].calcReduceRate(this.resudeRateCover)}};D6.consCOsum=D6.object(D6.ConsBase);D6.consCOsum.init=function(){this.coolLoadUnit_Wood=220;this.coolLoadUnit_Steel=145;this.apf=4;this.reduceRateSunCut=0.1;this.consName="consCOsum";this.consCode="CO";this.title="cooling";this.orgCopyNum=0;this.groupID="2";this.color="#0000ff";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="how to use air cooling in the whole house"};D6.consCOsum.init();D6.consCOsum.precalc=function(){this.clear();this.person=this.input("i001",3);this.houseSize=this.input("i003",(this.person==1?60:(80+this.person*10)));this.houseType=this.input("i002",1);this.coolArea=this.input("i201",0.5);this.coolTime=this.input("i261",4);this.coolTemp=this.input("i263",27)};D6.consCOsum.calc=function(){var coolKcal=this.calcCoolLoad();coolKcal*=D6.area.seasonMonth.summer/12;this.electricity=coolKcal/this.apf/D6.Unit.calorie.electricity};D6.consCOsum.calcMeasure=function(){this.measures["mCOsunCut"].calcReduceRate(this.reduceRateSunCut)};D6.consCOsum.calcCoolLoad=function(){var energyLoad=0;var coolLoadUnit=0;if(this.houseType==1){coolLoadUnit=this.coolLoadUnit_Wood}else{coolLoadUnit=this.coolLoadUnit_Steel}var coolArea_m2;coolArea_m2=this.houseSize*this.coolArea;if(this.coolArea>0.05){coolArea_m2=Math.max(coolArea_m2,13)}var coolTime;coolTime=this.coolTime;var coolMonth=D6.area.seasonMonth.summer;var coolFactor=D6.area.getCoolFactor(coolMonth,coolTime);var coefTemp;coefTemp=(27-this.coolTemp)/10+1;energyLoad=coolLoadUnit*coolFactor[0]*coolArea_m2*coolTime*30*coefTemp;return energyLoad};D6.consACcool=D6.object(D6.consCOsum);D6.consACcool.init=function(){this.consName="consACcool";this.consCode="";this.title="room air conditioning";this.orgCopyNum=1;this.addable="room air conditioning";this.groupID="2";this.color="#0000ff";this.countCall="th room";this.sumConsName="consCOsum";this.sumCons2Name="consAC";this.inputGuide="how to use air conditioning for each room"};D6.consACcool.init();D6.consACcool.precalc=function(){this.clear();this.houseSize=1;this.ac=D6.consListByName["consAC"][this.subID];this.coolArea=this.input("i212"+this.subID,12);this.coolTime=this.input("i271"+this.subID,this.sumCons.coolTime);this.coolTemp=this.input("i273"+this.subID,this.sumCons.coolTemp)};D6.consACcool.calc=function(){var coolKcal=this.calcCoolLoad();coolKcal*=D6.area.seasonMonth.summer/12;this.electricity=coolKcal/this.ac.apf/D6.Unit.calorie.electricity};D6.consACcool.calc2nd=function(){if(this.subID==0){this.electricity=this.sumCons.electricity;var cons=D6.consListByName[this.consName];for(var i=1;i<cons.length;i++){this.electricity-=cons[i].electricity}}};D6.consACcool.calcMeasure=function(){if(this.subID>0||this.electriity==this.sumCons.electricity)return;if(this.coolTemp<28&&this.coolTemp>20){this.measures["mCOtemplature"].calcReduceRate((28-this.coolTemp)/10)}else{this.measures["mCOtemplature"].calcReduceRate(0)}};﻿D6.consHTsum=D6.object(D6.ConsBase);D6.consHTsum.init=function(){this.consName="consHTsum";this.consCode="HT";this.title="heating";this.orgCopyNum=0;this.groupID="2";this.color="#ff0000";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="how to use the whole house heating";this.heatMcal;this.heatACCalcMcal;this.heatLoadUnit_Wood=220*1.25*0.82;this.heatLoadUnit_Steel=145*1.25*0.82;this.apf=3;this.apfMax=4.5;this.reduceRateInsulation=0.082;this.reduceRateDouble=0.124;this.reduceRateUchimado=0.14;this.reduceRateLowe=0.16;this.reduceRateFilterCool=0.05;this.reduceRateFilter=0.12;this.reduceRateDanran=0.303};D6.consHTsum.init();D6.consHTsum.precalc=function(){this.clear();this.prefecture=this.input("i021",13);this.heatArea=D6.area.getHeatingLevel(this.prefecture);this.person=this.input("i001",3);this.houseType=this.input("i002",1);this.houseSize=D6.consShow["TO"].houseSize;this.heatSpace=this.input("i201",this.heatArea<=2?0.6:this.heatArea==3?0.25:0.2);this.heatEquip=this.input("i202",-1);this.heatTime=this.input("i204",this.heatArea==1?24:this.heatArea==2?10:this.heatArea==3?6:6);this.heatTemp=this.input("i205",21);this.priceEleSpring=this.input("i0912",-1);this.priceEleWinter=this.input("i0911",-1);this.priceGasSpring=this.input("i0922",-1);this.priceGasWinter=this.input("i0921",-1);this.consKeros=this.input("i064",-1);this.hotwaterEquipType=this.input("i101",-1);this.performanceWindow=this.input("i041",-1);this.performanceWall=this.input("i042",-1);this.reformWindow=this.input("i043",-1);this.reformfloor=this.input("i044",-1)};D6.consHTsum.calc=function(){var heatKcal=this.calcHeatLoad();heatKcal*=D6.area.seasonMonth.winter/12;this.endEnergy=heatKcal;if(this.heatEquip<=0){if(this.consKeros>0||D6.area.averageCostEnergy.kerosene>1000){this.heatEquip=4}else if(this.priceGasWinter<0||this.priceGasWinter>4000){this.heatEquip=3}else{this.heatEquip=1}}var elecOver=0;var coef=(this.heatEquip==1?this.apf:1);if(this.heatEquip==1||this.heatEquip==2){if(this.priceEleWinter>0){var priceMaxCons=this.priceEleWinter*0.7/D6.Unit.price.electricity*D6.Unit.seasonMonth.winter/12;if(heatKcal/coef/D6.Unit.calorie.electricity>priceMaxCons){var elecOver=heatKcal-priceMaxCons*coef*D6.Unit.calorie.electricity;heatKcal-=elecOver}}}if(this.heatEquip==1||this.heatEquip==2){this.mainSource="electricity"}else if(this.heatEquip==3){this.mainSource="gas"}else if(this.heatEquip==4){this.mainSource="kerosene"}else{this.mainSource=this.sumCons.mainSource}this.calcACkwh=heatKcal/this.apf/D6.Unit.calorie.electricity;if(this.mainSource=="electricity"&&this.heatEquip!=2){this[this.mainSource]=this.calcACkwh}else{this[this.mainSource]=heatKcal/D6.Unit.calorie[this.mainSource]}var consbyprice=-1;consbyprice=(this.priceEleWinter-this.priceEleSpring)/D6.Unit.price.electricity;if(this.priceEleSpring!=-1&&this.priceEleWinter!=-1){if(this.hotwaterEquipType!=5&&this.hotwaterEquipType!=6){this.electricity=(this.electricity*2+consbyprice)/3}}else{this.electricity=(this.electricity*4+consbyprice)/5}consbyprice=(this.priceGasWinter-this.priceGasSpring)/D6.Unit.price.gas;var gasover=0;if(this.priceGasSpring!=-1&&this.priceGasWinter!=-1){if(this.hotwaterEquipType>=3&&this.hotwaterEquipType<=6){this.gas=(this.gas*3+consbyprice)/4}else{this.gas=(this.gas*2+consbyprice)/3}}else{this.gas=(this.gas*4+consbyprice)/5}gasover=Math.max(0,this.gas-consbyprice);var keroseneover=0;if(this.consKeros!=-1&&this.hotwaterEquipType!=3&&this.hotwaterEquipType!=4){consbyprice=this.consKeros/D6.Unit.price.kerosene;keroseneover=Math.max(0,this.kerosene-consbyprice);this.kerosene=consbyprice}if(elecOver>0){if(D6.Unit.areaHeating<=4&&this.priceKeros>0){this.kerosene+=elecOver*D6.Unit.calorie.electricity/D6.Unit.calorie.kerosene}else{this.gas+=elecOver*D6.Unit.calorie.electricity/D6.Unit.calorie.gas}}if(gasover>0){if(this.priceKeros>0){this.kerosene=Math.min(gasover*D6.Unit.calorie.gas/D6.Unit.calorie.kerosene,this.consKeros/D6.Unit.price.kerosene)}else{this.electricity+=gasover*D6.Unit.calorie.gas/D6.Unit.calorie.electricity}}if(keroseneover>0){this.electricity+=keroseneover*D6.Unit.calorie.kerosene/D6.Unit.calorie.electricity}this.calcACkwh=heatKcal/this.apf/D6.Unit.calorie.electricity;if(this.mainSource=="electricity"&&this.heatEquip!=2){this[this.mainSource]=this.calcACkwh}else{this[this.mainSource]=heatKcal/D6.Unit.calorie[this.mainSource]}};D6.consHTsum.calc2nd=function(){var spaceK;var spaceG;var consHW=D6.consShow["HW"];var consTotal=D6.consShow["TO"];var consCK=D6.consShow["CK"];spaceK=Math.max(0,consTotal.kerosene-consHW.kerosene);spaceG=Math.max(0,consTotal.gas-consHW.gas-consCK.gas);if(this.heatEquip==4){if(this.kerosene>spaceK){if(this.kerosene-spaceK>spaceG*D6.Unit.calorie.gas/D6.Unit.calorie.kerosene){this.electricity=(this.kerosene-spaceK)*D6.Unit.calorie.kerosene/D6.Unit.calorie.electricity;this.electricity=Math.min(this.electricity,D6.consShow["TO"].electricity*D6.consShow["TO"].seasonPrice["electricity"][0]/D6.consShow["TO"].priceEle*D6.area.seasonMonth.winter/12*0.7);this.kerosene=spaceK;this.gas=spaceG}else{this.gas=(this.kerosene-spaceK)*D6.Unit.calorie.kerosene/D6.Unit.calorie.gas;this.kerosene=spaceK}}}if(spaceK>0){this.kerosene=spaceK}if(this.heatEquip==3){if(this.gas>spaceG){this.electricity=(this.gas-spaceG)*D6.Unit.calorie.gas/D6.Unit.calorie.electricity;this.gas=spaceG}}this.electricity+=D6.consListByName["consHWtoilet"][0].electricity};D6.consHTsum.calcHeatLoad=function(){var energyLoad=0;var heatLoadUnit=this.heatLoadUnit_Wood;if(this.heatArea==1){heatLoadUnit*=0.3}else if(this.heatArea<=2){heatLoadUnit*=0.6}if(this.performanceWall>=200){heatLoadUnit=this.heatLoadUnit_Wood*0.2}else if(this.performanceWall>=100){heatLoadUnit=this.heatLoadUnit_Wood*0.4}else if(this.performanceWall>=50){heatLoadUnit=this.heatLoadUnit_Wood*0.7}else if(this.performanceWall>=30){heatLoadUnit=this.heatLoadUnit_Wood}if(this.houseType==2){heatLoadUnit*=this.heatLoadUnit_Steel/this.heatLoadUnit_Wood}var heatArea_m2=this.houseSize*this.heatSpace;if(this.heatSpace>0.05){heatArea_m2=Math.max(heatArea_m2,13)}var heatMonth=D6.area.seasonMonth.winter;var heatFactor=D6.area.getHeatFactor(heatMonth,this.heatTime);var heatTimeFactor=Math.min(this.heatTime,(this.heatTime-8)*0.3+8)/this.heatTime;var coefTemp=(this.heatTemp-20)/10+1;energyLoad=heatLoadUnit*heatFactor[1]*heatArea_m2*this.heatTime*heatTimeFactor*30*coefTemp;return energyLoad};D6.consHTsum.calcHeatLoadbyPrice=function(){var energyLoad=0;return energyLoad};D6.consHTsum.calcAdjustStrategy=function(energyAdj){this.calcACkwh*=energyAdj[this.mainSource];this.endEnergy*=energyAdj[this.mainSource]};D6.consHTsum.calcMeasure=function(){if(!this.isSelected("mHTuchimadoAll")&&!this.isSelected("mHTloweAll")&&this.houseType!=2){this.measures["mHTdoubleGlassAll"].calcReduceRate(this.reduceRateDouble)}if(!this.isSelected("mHTloweAll")){this.measures["mHTuchimadoAll"].calcReduceRate(this.reduceRateUchimado)}if(this.houseType!=2){this.measures["mHTloweAll"].calcReduceRate(this.reduceRateLowe)}};﻿D6.consHTcold=D6.object(D6.ConsBase);D6.consHTcold.init=function(){this.consName="consHTcold";this.consCode="";this.title="In the cold climate area";this.orgCopyNum=0;this.groupID="2";this.color="#ff0000";this.countCall="";this.sumConsName="consHTsum";this.sumCons2Name="";this.inputGuide="How to use heating in cold climate area"};D6.consHTcold.init();D6.consHTcold.calc=function(){this.clear()};D6.consHTcold.calcMeasure=function(){};D6.consACheat=D6.object(D6.consHTsum);D6.consACheat.init=function(){this.consName="consACheat";this.consCode="";this.title="room heating";this.orgCopyNum=1;this.addable="room air conditioning";this.sumConsName="consHTsum";this.sumCons2Name="consAC";this.groupID="2";this.color="#ff0000";this.countCall="th room";this.inputGuide="how to use each room heating"};D6.consACheat.init();D6.consACheat.precalc=function(){this.clear();this.houseSize=1;this.ac=D6.consListByName["consAC"][this.subID];this.consHeat=Object.getPrototypeOf(this);this.heatSpace=this.input("i212"+this.subID,13);this.heatEquip=this.input("i231"+this.subID,this.consHeat.heatEquip);this.heatTime=this.input("i203"+this.subID,this.consHeat.heatTime);this.heatTemp=this.input("i204"+this.subID,this.consHeat.heatTemp);this.windowArea=this.input("i213"+this.subID,-1);this.windowPerf=this.input("i216"+this.subID,-1)};D6.consACheat.calc=function(){var heatKcal=this.calcHeatLoad();heatKcal*=D6.area.seasonMonth.winter/12;this.endEnergy=heatKcal;if(this.heatEquip<=0){this.heatEquip=this.consHeat.heatEquip}if(this.heatEquip==1||this.heatEquip==2){this.mainSource="electricity"}else if(this.heatEquip==3){this.mainSource="gas"}else if(this.heatEquip==4){this.mainSource="kerosene"}else{this.mainSource=this.sumCons.mainSource}this.calcACkwh=heatKcal/this.ac.apf/D6.Unit.calorie.electricity;if(this.mainSource=="electricity"&&this.heatEquip!=2){this[this.mainSource]=this.calcACkwh}else{this[this.mainSource]=heatKcal/D6.Unit.calorie[this.mainSource]}};D6.consACheat.calc2nd=function(){if(this.subID==0){this.copy(this.sumCons);var cons=D6.consListByName[this.consName];for(var i=1;i<cons.length;i++){this.sub(cons[i])}}};D6.consACheat.calcMeasure=function(){var mes;if(this.heatEquip==1){this.measures["mACfilter"].copy(this);this.measures["mACfilter"]["electricity"]=this.electricity*(1-this.reduceRateFilter)-D6.consShow["CO"].electricity*this.reduceRateFilterCool}else{this.measures["mACchangeHeat"].clear();this.measures["mACchangeHeat"].electricity=this.endEnergy/this.ac.nowEquip.pf2/D6.Unit.calorie.electricity;this.measures["mACfilter"].copy(this);this.measures["mACfilter"].electricity=this.electricity-D6.consShow["CO"].electricity*this.reduceRateFilterCool}if(this.person>=2&&this.heatSpace>0.3&&this.houseSize>40){this.measures["mHTdanran"].calcReduceRate(this.reduceRateDanran)}if(!this.sumCons.isSelected("mHTdoubleAll")&&!this.sumCons.isSelected("mHTuchimadoAll")&&!this.sumCons.isSelected("mHTloweAll")&&!this.sumCons.isSelected("mHTuchimado")&&!this.sumCons.isSelected("mHTlowe")){this.measures["mHTdouble"].calcReduceRate(this.reduceRateDouble)}if(!this.sumCons.isSelected("mHTuchimadoAll")&&!this.sumCons.isSelected("mHTloweAll")&&!this.sumCons.isSelected("mHTlowe")){this.measures["mHTuchimado"].calcReduceRate(this.reduceRateUchimado)}if(!this.sumCons.isSelected("mHTloweAll")){this.measures["mHTlowe"].calcReduceRate(this.reduceRateLowe)}this.measures["mHTwindowSheet"].calcReduceRate(this.reduceRateInsulation);if(this.heatTemp>=21){this.measures["mHTtemplature"].calcReduceRate((this.heatTemp-20)/10)}if(this.heatTime>2){this.measures["mHTtime"].calcReduceRate(1/(this.heatTime-1))}this.measures["mHTuchimado"].calcReduceRate(0.15);this.measures["mHTceiling"].calcReduceRate(0.1)};D6.consAC=D6.object(D6.ConsBase);D6.consAC.init=function(){this.consName="consAC";this.consCode="";this.title="room air conditioning";this.orgCopyNum=1;this.groupID="2";this.color="#ff0000";this.countCall="th room";this.sumConsName="";this.sumCons2Name="";this.inputDisp="consACcool";this.inputGuide="";this.consAddSet=["consACcool","consACheat"]};D6.consAC.init();D6.consAC.precalc=function(){this.clear();this.acYear=this.input("i215"+this.subID,6);this.acPerf=this.input("i216"+this.subID,2);this.acFilter=this.input("i217"+this.subID,　-1);this.roomSize=this.input("i212"+this.subID,12);var now=new Date();this.nowEquip=this.equip(now.getFullYear()-this.acYear,(this.roomSize<16?2.8:4));this.newEquip=this.equip(now.getFullYear(),(this.roomSize<16?2.8:4));this.apf=this.nowEquip.pf2*0.7;this.apfMax=this.newEquip.pf1*0.7;if(D6.debugMode){console.assert(this.equip(2015,2.8).pf1==6.5,"2015 2.8kW");console.assert(this.equip(2030,4.5).pf1==7,"2030 4.5kW");console.assert(this.equip(now.getFullYear(),4.5).pr1==200000,"now 4.5kW price");console.assert(this.equip(now.getFullYear(),4.5).pf1>6,"now 4.5kW price")}};D6.consAC.calc=function(){};D6.consAC.calc2nd=function(){this.acHeat=D6.consListByName["consACheat"][this.subID];this.acCool=D6.consListByName["consACcool"][this.subID];this.copy(this.acHeat);this.add(this.acCool)};D6.consAC.equip=function(year,size){var sizeThreshold=[2.8,4.5,100];var defEquip={2.8:{1900:{"pf1":3,"pf2":2,"pr1":150000,"pr2":120000},1995:{"pf1":3,"pf2":2,"pr1":150000,"pr2":120000},2005:{"pf1":5,"pf2":3.5,"pr1":150000,"pr2":120000},2015:{"pf1":6.5,"pf2":5,"pr1":150000,"pr2":120000},2030:{"pf1":7,"pf2":6,"pr1":150000,"pr2":120000}},4.5:{1900:{"pf1":3,"pf2":2,"pr1":200000,"pr2":160000},1995:{"pf1":3,"pf2":2,"pr1":200000,"pr2":160000},2005:{"pf1":4,"pf2":2.5,"pr1":200000,"pr2":160000},2015:{"pf1":6,"pf2":4,"pr1":200000,"pr2":160000},2030:{"pf1":7,"pf2":6,"pr1":200000,"pr2":160000}},100:{1900:{"pf1":3,"pf2":2,"pr1":240000,"pr2":220000},1995:{"pf1":3,"pf2":2,"pr1":240000,"pr2":220000},2005:{"pf1":3.5,"pf2":2.5,"pr1":240000,"pr2":220000},2015:{"pf1":4.5,"pf2":3.5,"pr1":240000,"pr2":220000},2030:{"pf1":6,"pf2":5,"pr1":240000,"pr2":220000}}};return this.getEquipParameters(year,size,sizeThreshold,defEquip)};D6.consAC.calcMeasure=function(){var mes;mes=this.measures["mACreplace"];if(!this.isSelected("mACreplaceHeat")){mes.copy(this);if(this.acHeat.heatEquip==1){mes.electricity=this.electricity*this.apf/this.apfMax;mes["consACheat"]=D6.object(D6.Energy);mes["consACheat"].copy(this.acHeat);mes["consACheat"].electricity=this.acHeat.electricity*this.apf/this.apfMax}else{mes.electricity-=this.acCool.electricity*(1-this.apf/this.apfMax)}mes["consACcool"]=D6.object(D6.Energy);mes["consACcool"].copy(this.acCool);mes["consACcool"].electricity=this.acCool.electricity*this.apf/this.apfMax;if(this.acHeat.heatArea>0.3&&this.acHeat.houseSize>60){var num=Math.round(Math.max(this.acHeat.houseSize*this.acHeat.heatArea,25)/25);mes.priceNew=num*mes.def["price"]}}mes=this.measures["mACreplaceHeat"];if(!this.acHeat.heatEquip==1){mes.clear();mes["consACheat"]=D6.object(D6.Energy);mes["consACheat"].copy(this.acHeat);mes["consACheat"].electricity=this.acHeat.endEnergy/　this.apfMax/D6.Unit.calorie.electricity;mes["consACcool"]=D6.object(D6.Energy);mes["consACcool"].copy(this.acCool);mes["consACcool"].electricity=this.acCool.electricity*this.acHeat.apf/this.apfMax;mes.electricity=mes["consACheat"].electricity+mes["consACcool"].electricity;if(this.heatArea>0.3&&this.houseSize>60){mes.priceNew=Math.round(Math.max(this.houseSize*this.heatArea,25)/25)*this.nowEquip.pr1}}};﻿D6.consRFsum=D6.object(D6.ConsBase);D6.consRFsum.init=function(){this.consName="consRFsum";this.consCode="RF";this.title="refrigerator";this.orgCopyNum=0;this.sumConsName="consTotal";this.sumCons2Name="";this.groupID="3";this.color="#a0ffa0";this.residueCalc="no";this.inputGuide="usage of refrigerator"};D6.consRFsum.init();D6.consRFsum.calc=function(){this.clear();this.count=this.input("i701",1)};D6.consRFsum.calcMeasure=function(){};D6.consRFsum.equip=function(year,size){var sizeThreshold=[100,200,300,400,500,1100];var defEquip={100:{1900:{"pf1":300,"pf2":400,"pr1":50000,"pr2":40000},2005:{"pf1":300,"pf2":400,"pr1":50000,"pr2":40000},2015:{"pf1":250,"pf2":350,"pr1":50000,"pr2":40000},2030:{"pf1":250,"pf2":350,"pr1":50000,"pr2":40000}},200:{1900:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000},2005:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000},2015:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000},2030:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000}},300:{1900:{"pf1":500,"pf2":750,"pr1":120000,"pr2":100000},2005:{"pf1":450,"pf2":550,"pr1":120000,"pr2":100000},2015:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000},2030:{"pf1":350,"pf2":450,"pr1":90000,"pr2":70000}},400:{1900:{"pf1":700,"pf2":950,"pr1":140000,"pr2":120000},1995:{"pf1":650,"pf2":900,"pr1":140000,"pr2":120000},2015:{"pf1":300,"pf2":550,"pr1":120000,"pr2":100000},2030:{"pf1":300,"pf2":400,"pr1":120000,"pr2":100000}},500:{1900:{"pf1":900,"pf2":1300,"pr1":200000,"pr2":180000},1995:{"pf1":900,"pf2":1200,"pr1":200000,"pr2":180000},2015:{"pf1":300,"pf2":550,"pr1":160000,"pr2":140000},2030:{"pf1":300,"pf2":400,"pr1":160000,"pr2":140000}},1100:{1900:{"pf1":1000,"pf2":1500,"pr1":220000,"pr2":200000},1995:{"pf1":900,"pf2":1400,"pr1":220000,"pr2":200000},2015:{"pf1":400,"pf2":750,"pr1":200000,"pr2":180000},2030:{"pf1":400,"pf2":500,"pr1":200000,"pr2":180000}}};return this.getEquipParameters(year,size,sizeThreshold,defEquip)};﻿D6.consRF=D6.object(D6.consRFsum);D6.consRF.init=function(){this.consYear=650;this.consYearAdvanced=300;this.reduceRateWall=0.1;this.reduceRateTemplature=0.12;this.consName="consRF";this.consCode="";this.title="refrigerator";this.orgCopyNum=1;this.addable="refrigerator";this.groupID="3";this.color="#a0ffa0";this.countCall="th";this.sumConsName="consRFsum";this.sumCons2Name="";this.inputGuide="How to use each refrigerator"};D6.consRF.init();D6.consRF.precalc=function(){this.clear();this.year=this.input("i711"+this.subID,8);this.type=this.input("i712"+this.subID,1);this.size=this.input("i713"+this.subID,350);this.templature=this.input("i714"+this.subID,4);this.full=this.input("i715"+this.subID,4);this.space=this.input("i716"+this.subID,3);var d=new Date();this.nowEquip=this.equip(d.getFullYear()-this.year,this.size);this.newEquip=this.equip(d.getFullYear(),this.size)};D6.consRF.calc=function(){this.consYear=this.nowEquip.pf2*(this.type==2?2:1);this.consYearAdvanced=this.newEquip.pf1*(this.type==2?2:1);this.reduceRateChange=this.consYearAdvanced/this.consYear;if(this.subID==0){if(this.input("i7111",-1)<0&&this.input("i7131",-1)<0){this.electricity=this.consYear*this.count/12}else{this.electricity=0}return}if(this.subID>0&&this.input("i711"+this.subID,-1)<0&&this.input("i713"+this.subID,-1)<0){return}this.electricity=this.consYear/12;this.electricity=this.electricity*(this.full==3?1.1:(this.full==1?0.9:1));this.electricity=this.electricity*(this.space==1?0.95:(this.space==2?1.05:1));this.electricity=this.electricity*(this.templature==1?1.1:(this.templature==3?0.95:1))};D6.consRF.calcMeasure=function(){this.measures["mRFreplace"].calcReduceRate(this.reduceRateChange);if(this.templature!=3){this.measures["mRFtemplature"].calcReduceRate(this.reduceRateTemplature)}if(this.space!=1){this.measures["mRFwall"].calcReduceRate(this.reduceRateWall)}if(this.count>1){if(this.subID==0){this.measures["mRFstop"].calcReduceRate(1/this.count)}else{this.measures["mRFstop"].electricity=0}}};﻿D6.consLIsum=D6.object(D6.ConsBase);D6.consLIsum.init=function(){this.consName="consLIsum";this.consCode="";this.title="light";this.orgCopyNum=0;this.groupID="6";this.color="#ffff00";this.residueCalc="sumup";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="how to use the whole house lighting";this.lightTime=6;this.performanceLED=140;this.performanceHF=100;this.performanceFlueciend=70;this.preformanceBulb=15;this.wattLivingBulb=300;this.wattLivingFlue=70;this.wattLivingLED=40;this.outdoorWatt=150;this.outdoorTime=0.5;this.sensorWatt=2;this.reduceRateBulb=1-this.preformanceBulb/this.performanceFlueciend;this.reduceRateCeiling=1-this.performanceFlueciend/this.performanceLED;this.reduceRateLED=1-this.preformanceBulb/this.performanceLED};D6.consLIsum.init();D6.consLIsum.precalc=function(){this.clear();this.person=this.input("i001",3);this.lightType=this.input("i501",2);this.otherRate=this.input("i502",3);this.houseSize=D6.consShow["TO"].houseSize};D6.consLIsum.calc=function(){if(this.lightType==1){this.sumWatt=this.wattLivingBulb}else if(this.lightType==3){this.sumWatt=this.wattLivingLED}else{this.sumWatt=this.wattLivingFlue}this.electricity=this.sumWatt*this.lightTime/1000*30;this.electricity*=(Math.max(this.houseSize-20,0)/20*0.2+1);this.electricity*=(Math.max(this.houseSize-20,0)/20*0.5*(this.otherRate/10)+1)};D6.consLIsum.calc2nd=function(){var electricity=this.electricity;this.clear();for(var id in this.partCons){this.add(this.partCons[id])}if(electricity>this.electricity){this.electricity=electricity}};D6.consLIsum.calcMeasure=function(){};﻿D6.consLI=D6.object(D6.consLIsum);D6.consLI.init=function(){this.consName="consLI";this.consCode="";this.title="light";this.orgCopyNum=1;this.addable="room for lighting";this.groupID="6";this.color="#ffff00";this.countCall="th room";this.sumConsName="consLIsum";this.sumCons2Name="";this.inputGuide="how to use each room lighting"};D6.consLI.init();D6.consLI.precalc=function(){this.clear();var roomNames=['','玄関','門灯','廊下','トイレ','脱衣所','風呂','居室'];this.rid=this.input("i511"+this.subID,0);this.mesTitlePrefix=this.rid?roomNames[this.rid]:this.mesTitlePrefix;this.type=this.input("i512"+this.subID,2);this.watt=this.input("i513"+this.subID,-1);this.num=this.input("i514"+this.subID,0);this.time=this.input("i515"+this.subID,this.lightTime)};D6.consLI.calc=function(){if(!(this.watt>0)){if(this.type<=2){this.watt=60}else{this.watt=100}}this.electricity=this.watt*this.time*this.num/1000*365　/12};D6.consLI.calc2nd=function(){if(this.subID==0){this.electricity=this.sumCons.electricity;var cons=D6.consListByName[this.consName];for(var i=1;i<cons.length;i++){this.electricity-=cons[i].electricity}if(this.lightType==1){this.type=1}else if(this.lightType==3){this.type=5}else{this.type=2}this.watt=this.sumWatt;this.num=1}};D6.consLI.calcMeasure=function(){var rejectSelect=false;var mes;if(this.isSelected("mLILED")||this.isSelected("mLIceilingLED")||this.isSelected("mLIsensor")){rejectSelect=true}if((this.type==5||this.type==6)||this.watt<20||rejectSelect){}else{if(this.type==1){this.measures["mLILED"].calcReduceRate(this.reduceRateLED)}else if(this.type==2||this.type==3){this.measures["mLILED"].calcReduceRate((this.reduceRateLED-this.reduceRateBulb)/this.reduceRateLED)}}if(this.type==3&&this.watt*this.num>50&&!rejectSelect){this.measures["mLIceilingLED"].calcReduceRate(this.reduceRateCeiling)}if(this.rid>=1&&this.rid<=3){this.measures["mLIsensor"].electricity=(this.outdoorWatt*this.outdoorTime+this.sensorWatt*24)*365/1000/12}if(this.time>=2){this.measures["mLItime"].calcReduceRate(1/(this.time-1))}};﻿D6.consTVsum=D6.object(D6.ConsBase);D6.consTVsum.init=function(){this.watt=100;this.reduceRateRadio=0.5;this.reduceRateBright=0.2;this.consName="consTVsum";this.consCode="TV";this.title="TV";this.orgCopyNum=1;this.groupID="7";this.color="#00ff00";this.sumConsName="consTotal";this.sumCons2Name="";this.residueCalc="sumup";this.inputGuide="how to use TV totally"};D6.consTVsum.init();D6.consTVsum.calc=function(){this.useTime=this.input("i601",8.5);this.electricity=this.watt/1000*this.useTime*30};D6.consTVsum.calc2nd=function(){var electricity=this.electricity;this.clear();for(var id in this.partCons){this.add(this.partCons[id])}if(electricity>this.electricity){this.electricity=electricity}};D6.consTVsum.equip=function(year,size){var sizeThreshold=[20,30,40,50,60,120];var defEquip={20:{1900:{"pf1":100,"pf2":150,"pr1":500000,"pr2":400000},1995:{"pf1":50,"pf2":100,"pr1":50000,"pr2":40000},2005:{"pf1":40,"pf2":80,"pr1":40000,"pr2":30000},2015:{"pf1":30,"pf2":50,"pr1":30000,"pr2":25000},2030:{"pf1":20,"pf2":30,"pr1":30000,"pr2":25000}},30:{1900:{"pf1":150,"pf2":300,"pr1":500000,"pr2":400000},1995:{"pf1":80,"pf2":150,"pr1":80000,"pr2":60000},2005:{"pf1":50,"pf2":100,"pr1":50000,"pr2":40000},2015:{"pf1":40,"pf2":60,"pr1":40000,"pr2":35000},2030:{"pf1":30,"pf2":40,"pr1":40000,"pr2":35000}},40:{1900:{"pf1":400,"pf2":500,"pr1":500000,"pr2":400000},1995:{"pf1":300,"pf2":500,"pr1":200000,"pr2":150000},2005:{"pf1":100,"pf2":200,"pr1":120000,"pr2":100000},2015:{"pf1":60,"pf2":120,"pr1":100000,"pr2":80000},2030:{"pf1":40,"pf2":80,"pr1":80000,"pr2":70000}},50:{1900:{"pf1":500,"pf2":700,"pr1":500000,"pr2":400000},1995:{"pf1":500,"pf2":700,"pr1":400000,"pr2":300000},2005:{"pf1":200,"pf2":400,"pr1":200000,"pr2":180000},2015:{"pf1":100,"pf2":200,"pr1":140000,"pr2":120000},2030:{"pf1":80,"pf2":160,"pr1":100000,"pr2":90000}},60:{1900:{"pf1":500,"pf2":700,"pr1":500000,"pr2":400000},1995:{"pf1":500,"pf2":700,"pr1":500000,"pr2":400000},2005:{"pf1":250,"pf2":500,"pr1":400000,"pr2":300000},2015:{"pf1":120,"pf2":200,"pr1":180000,"pr2":160000},2030:{"pf1":100,"pf2":180,"pr1":160000,"pr2":150000}},120:{1900:{"pf1":500,"pf2":700,"pr1":500000,"pr2":400000},1995:{"pf1":500,"pf2":700,"pr1":500000,"pr2":400000},2005:{"pf1":350,"pf2":500,"pr1":400000,"pr2":300000},2015:{"pf1":200,"pf2":400,"pr1":180000,"pr2":160000},2030:{"pf1":180,"pf2":250,"pr1":160000,"pr2":150000}}};return this.getEquipParameters(year,size,sizeThreshold,defEquip)};D6.consTVsum.calcMeasure=function(){this.measures["mTVradio"].calcReduceRate(this.reduceRateRadio)};﻿D6.consTV=D6.object(D6.consTVsum);D6.consTV.init=function(){this.consName="consTV";this.consCode="";this.title="TV";this.orgCopyNum=1;this.addable="TV";this.groupID="7";this.color="#00ff00";this.countCall="th";this.sumConsName="consTVsum";this.sumCons2Name="";this.inputGuide="How to use each TV"};D6.consTV.init();D6.consTV.precalc=function(){this.clear();this.size=this.input("i631"+this.subID,32);this.year=this.input("i632"+this.subID,6);if(this.subID==1){this.useTime=this.input("i633"+this.subID,8.5)}else{this.useTime=this.input("i633"+this.subID,0)}var d=new Date();this.nowEquip=this.equip(d.getFullYear()-this.year,this.size);this.newEquip=this.equip(d.getFullYear(),this.size);this.nowWatt=this.nowEquip.pf2;this.newWatt=this.newEquip.pf1};D6.consTV.calc=function(){this.reduceRateReplace=(1-this.newWatt/this.nowWatt);this.electricity=this.useTime*this.nowWatt/1000*30};D6.consTV.calc2nd=function(){if(this.subID==0){this.electricity=this.sumCons.electricity;var cons=D6.consListByName[this.consName];for(var i=1;i<cons.length;i++){this.electricity-=cons[i].electricity}}};D6.consTV.calcMeasure=function(){if(this.subID==0&&D6.consListByName[this.consName][1].electricity>0)return;if(this.useTime>2){this.measures["mTVtime"].calcReduceRate(1/(this.useTime-1))}this.measures["mTVbright"].calcReduceRate(this.reduceRateBright);this.measures["mTVreplace"].calcReduceRate(this.reduceRateReplace)};﻿D6.consDRsum=D6.object(D6.ConsBase);D6.consDRsum.init=function(){this.whWash=100;this.whDry=1000;this.reduceRateHeatPump=0.65;this.res2Freq=[0,1,0.5,0.2,0.07,0];this.consName="consDRsum";this.consCode="DR";this.title="laundry washing";this.orgCopyNum=0;this.groupID="5";this.color="#00ffff";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="How to use the cleaner, washing machine and clothes dryer"};D6.consDRsum.init();D6.consDRsum.precalc=function(cons){this.clear();this.dryUse=this.input("i401",0);this.person=D6.consShow["TO"].person};D6.consDRsum.calc=function(cons){this.rateDry=(this.whDry*this.res2Freq[this.dryUse])/(this.whWash+this.whDry*this.res2Freq[this.dryUse]);this.electricity=(this.whWash+this.whDry*this.res2Freq[this.dryUse])/1000*this.person/3*30};D6.consDRsum.calcMeasure=function(){this.measures["mDRheatPump"].calcReduceRate(this.rateDry*this.reduceRateHeatPump);this.measures["mDRsolar"].calcReduceRate(this.rateDry)};﻿D6.consCRsum=D6.object(D6.ConsBase);D6.consCRsum.init=function(){this.performanceNow=10;this.performanceNew=25;this.performanceElec=8;this.publicRate=0.6;this.walkRate=0.2;this.reduceRateEcoDrive=0.15;this.reduceRatePublic=0.7;this.consName="consCRsum";this.consCode="CR";this.title="vehicle";this.orgCopyNum=0;this.groupID="8";this.color="#ee82ee";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.inputGuide="How to use cars, automobile"};D6.consCRsum.init();D6.consCRsum.precalc=function(){this.clear();this.priceCar=D6.consShow["TO"].priceCar;this.carNum=this.input("i901",-1);this.car=this.priceCar/D6.Unit.price.car; };D6.consCRsum.calc=function(){};D6.consCRsum.calcMeasure=function(){this.measures["mCRecoDrive"].calcReduceRate(this.reduceRateEcoDrive)};﻿D6.consCR=D6.object(D6.consCRsum);D6.consCR.init=function(){this.consName="consCR";this.consCode="";this.title="vehicle";this.orgCopyNum=1;this.groupID="8";this.color="#ee82ee";this.countCall="th car";this.addable="vehicle";this.sumConsName="";this.sumCons2Name="consCRsum";this.inputGuide="the performance and use of each car"};D6.consCR.init();D6.consCR.precalc=function(){this.clear();this.carType=this.input("i911"　+this.subID,1);this.performance=this.input("i912"　+this.subID,12);this.user=this.input("i913"　+this.subID,this.subID　+this.countCall);this.ecoTier=this.input("i914"　+this.subID,3)};D6.consCR.calc=function(){};D6.consCR.calc2nd=function(){var trsum=0;var carnum=D6.consListByName["consCR"].length;var tripnum=D6.consListByName["consCRtrip"].length;for(i=1;i<tripnum;i++){trsum+=D6.consListByName["consCRtrip"][i].car}if(trsum==0){if(this.subID==0){this.car=this.sumCons2.car}else{this.car*=Math.pow(0.5,this.subID);if(this.subID==carnum-1){this.car*=2}}}else{this.car*=this.sumCons2.car/trsum}};D6.consCR.calcMeasure=function(){if(!this.isSelected("mCRreplaceElec")){this.measures["mCRreplace"].calcReduceRate((this.performanceNew-this.performanceNow)/this.performanceNew)}if(!this.isSelected("mCRreplace")){this.measures["mCRreplaceElec"].clear();this.measures["mCRreplaceElec"].electricity=this.performanceNow*this.car/this.performanceElec}};﻿D6.consCRtrip=D6.object(D6.consCRsum);D6.consCRtrip.init=function(){this.consName="consCRtrip";this.consCode="";this.title="movement";this.orgCopyNum=1;this.groupID="8";this.color="#ee82ee";this.countCall="th places";this.addable="destination";this.sumConsName="consCRsum";this.sumCons2Name="";this.inputGuide="how to use cars by destinations"};D6.consCRtrip.init();D6.consCRtrip.precalc=function(){this.clear();this.mesTitlePrefix=this.input("i921"+this.subID,this.mesTitlePrefix);this.frequency=this.input("i922"+this.subID,250);this.km=this.input("i923"+this.subID,0);this.carID=this.input("i924"+this.subID,1);this.consCar=D6.consListByName["consCR"][this.carID]};D6.consCRtrip.calc=function(){this.performance=this.consCar.performance;this.car=this.km*2*this.frequency/12/this.performance;this.consCar.car+=this.car};D6.consCRtrip.calc2nd=function(){if(this.subID==0){this.car=this.sumCons.car;var cons=D6.consListByName[this.consName];for(var i=1;i<cons.length;i++){this.car-=cons[i].car}}};D6.consCRtrip.calcMeasure=function(){if(this.km<3){this.measures["mCRwalk"].calcReduceRate(this.walkRate)}this.measures["mCR20percent"].calcReduceRate(0.2);this.measures["mCRtrain"].calcReduceRate(this.reduceRatePublic*this.publicRate)};D6.consCKpot=D6.object(D6.ConsBase);D6.consCKpot.init=function(){this.wattOrdinal=30;this.consName="consCKpot";this.consCode="CK";this.title="heat holding pot";this.orgCopyNum=0;this.groupID="4";this.color="#ffe4b5";this.countCall="";this.sumConsName="consCKsum";this.sumCons2Name="";this.inputGuide="How to use heat holding pot"};D6.consCKpot.init();D6.consCKpot.precalc=function(){this.clear();this.time=this.input("i821",6);this.ecoType=this.input("i822",3)};D6.consCKpot.calc=function(){this.electricity=this.wattOrdinal*this.time*30/1000*(this.ecoType==1?0.5:1)};D6.consCKpot.calcMeasure=function(){};D6.consCKcook=D6.object(D6.ConsBase);D6.consCKcook.init=function(){this.consEnergyStat=840000;this.efficentEL=2;this.consName="consCKcook";this.consCode="CK";this.title="Cooking";this.orgCopyNum=0;this.groupID="4";this.color="#ffe4b5";this.sumConsName="consCKsum";this.sumCons2Name="";this.inputGuide="How to use cooking to focus on the stove"};D6.consCKcook.init();D6.consCKcook.precalc=function(){this.clear();this.equipHW=this.input("i101",2);this.equipCK=this.input("i801",-1);this.person=this.input("i001",3)};D6.consCKcook.calc=function(){this.priceGas=D6.consShow["TO"].priceGas;this.consEnergy=this.consEnergyStat*this.person/3;if(this.equipCK==-1){if(this.equipHW==5||this.equipHW==6||this.priceGas==0){this.equipCK=2}else{this.equipCK=1}}if(this.equipCK==2){this.electricity=this.consEnergy/12/this.efficentEL/D6.Unit.calorie.electricity}else{this.gas=this.consEnergy/12/D6.Unit.calorie.gas}};D6.consCKcook.calcMeasure=function(){};D6.consCKrice=D6.object(D6.ConsBase);D6.consCKrice.init=function(){this.wattOrdinal=30;this.consName="consCKrice";this.consCode="CK";this.title="rice cooker";this.orgCopyNum=0;this.groupID="4";this.color="#ffe4b5";this.countCall="";this.sumConsName="consCKsum";this.sumCons2Name="";this.inputGuide="how to use rice cooker"};D6.consCKrice.init();D6.consCKrice.precalc=function(){this.clear();this.person=this.input("i001",3);this.frequency=this.input("i802",5);this.time=this.input("i820",6)};D6.consCKrice.calc=function(){this.electricity=this.wattOrdinal*this.time*30/1000};D6.consCKrice.calcMeasure=function(){};D6.consCKsum=D6.object(D6.ConsBase);D6.consCKsum.init=function(){this.consName="consCKsum";this.consCode="CK";this.title="Cooking";this.orgCopyNum=0;this.groupID="4";this.color="#ffe4b5";this.countCall="";this.sumConsName="consTotal";this.sumCons2Name="";this.residueCalc="no";this.inputGuide="How to use cooking equipments"};D6.consCKsum.init();D6.consCKsum.calc=function(){this.clear()};D6.consCKsum.calcMeasure=function(){};var D6=D6||{};D6.consList=[];D6.consListByName=[];D6.consShow=[];D6.measureList=[];D6.monthly=[];D6.resMeasure=[];D6.mesCount=0;D6.consCount=0;D6.average={consList:""};D6.isOriginal=true;D6.sortTarget="co2ChangeOriginal";D6.viewparam={};D6.debugMode=false;D6.constructor=function(a,b,c){D6.setscenario(a,b,c)};D6.calculateAll=function(){D6.calcCons();D6.calcAverage();D6.calcMeasures(-1)};var D6=D6||{};D6.setscenario=function(prohibitQuestions,allowedQuestions,defInput){var i,j,k;var notinit=false;if(prohibitQuestions=="add"){notinit=true}if(!prohibitQuestions){prohibitQuestions=[]}if(!allowedQuestions){allowedQuestions=[]}if(!notinit){D6.scenario.setDefs();D6.scenario.areafix();for(var d in defInput){if(defInput[d][2]){D6.scenario.defInput[defInput[d][0]][defInput[d][1]]=defInput[d][2]}}D6.logicList=D6.scenario.getLogicList()}var consList=D6.consList;var cname;D6.consCount=0;var logic;var tlogic;for(logic in D6.logicList){tlogic=D6.logicList[logic];D6.consListByName[tlogic.consName]=[];if(tlogic.sumConsName=="consTotal"||tlogic.consName=="consTotal"){consList[D6.consCount]=tlogic;D6.consShow[tlogic.consCode]=consList[D6.consCount];D6.consListByName[tlogic.consName].push(consList[D6.consCount]);D6.consCount++}}for(logic in D6.logicList){tlogic=D6.logicList[logic];if(tlogic.sumConsName!="consTotal"&&tlogic.consName!="consTotal"){if(tlogic.orgCopyNum==0){consList[D6.consCount]=tlogic;D6.consListByName[tlogic.consName].push(consList[D6.consCount]);D6.consCount++}else{for(j=0;j<=tlogic.orgCopyNum;j++){consList[D6.consCount]=D6.object(tlogic);consList[D6.consCount].setsubID(j);D6.consListByName[tlogic.consName].push(consList[D6.consCount]);D6.consCount++}}}}var cons;var partconsTemp;var partCons;var partCons2nd;for(i=0;i<consList.length;i++){cons=consList[i];cons.measures=[];cons.partCons=[];cons.sumCons=this.getTargetConsList(cons.sumConsName);cons.sumCons2=this.getTargetConsList(cons.sumCons2Name);partCons=[];partCons2nd=[];for(j=0;j<consList.length;j++){partconsTemp=consList[j];if(partconsTemp.sumConsName===cons.consName){if(partconsTemp.orgCopyNum>=1){if(cons.orgCopyNum>=1){if(cons.subID==partconsTemp.subID){cons.partConsName=partconsTemp.consName;partCons.push(partconsTemp)}}else{cons.partConsName=partconsTemp.consName;partCons.push(partconsTemp)}}else{partCons.push(partconsTemp)}}if(partconsTemp.sumCons2Name==cons.consName){if(partconsTemp.orgCopyNum>=1){if(cons.orgCopyNum>=1){if(cons.subID==partconsTemp.subID){cons.partCons2Name=partconsTemp.consName;partCons2nd.push(partconsTemp)}}else{cons.partCons2Name=partconsTemp.consName;partCons2nd.push(partconsTemp)}}else{partCons2nd.push(partconsTemp)}}}if(partCons.length>=1){cons.partCons=partCons}else{cons.partCons=""}if(partCons2nd.length>=1){cons.partCons2=partCons2nd}else{cons.partCons2=""}}this.mesCount=0;for(i in consList){this.addMeasureEachCons(consList[i])}var isProhivitedQuestion=function(iname){if(iname["cons"]=="")return true;if(prohibitQuestions.length<=0){if(allowedQuestions.length<=0){return false}else{if(allowedQuestions.indexOf(iname)>=0){return false}else{return true}}}else{if(prohibitQuestions.indexOf(iname)>=0){return true}else{return false}}};var iname;for(iname in D6.scenario.defInput){if(isProhivitedQuestion(iname))continue;var defInp=D6.scenario.defInput[iname];logic=D6.logicList[defInp.cons];if(logic){if(logic.orgCopyNum>0){for(j=0;j<logic.orgCopyNum;j++){D6.inSet(iname+(j+1),defInp.defaultValue)}}else{D6.inSet(iname,defInp.defaultValue)}}}var ilist=[];if(D6.scenario.defEasyQues){for(var i in D6.scenario.defEasyQues[0].ques){if(isProhivitedQuestion(D6.scenario.defEasyQues[0].ques[i]))continue;ilist.push(D6.scenario.defEasyQues[0].ques[i])}D6.scenario.defEasyQues[0].ques=[];for(i in ilist){D6.scenario.defEasyQues[0].ques.push(ilist[i])}}};D6.addMeasureEachCons=function(cons){for(var mesname in D6.scenario.defMeasures){if(cons.consName!=D6.scenario.defMeasures[mesname].refCons)continue;this.measureList[this.mesCount]=D6.object(D6.MeasureBase);this.measureList[this.mesCount].Constructor(cons,D6.scenario.defMeasures[mesname],this.mesCount);cons.measures[mesname]=this.measureList[this.mesCount];this.mesCount++}};D6.addConsSetting=function(consName){var cons="";var pname="";var rend=false;for(cons in D6.logicList){pname=D6.logicList[cons].consAddSet;for(var t in pname){if(pname[t]==consName||cons==consName){D6.logicList[cons].orgCopyNum=D6.logicList[cons].orgCopyNum+1;for(var s in pname){D6.logicList[pname[s]].orgCopyNum=D6.logicList[pname[s]].orgCopyNum+1}rend=true;break}}if(rend)break}if(!rend){D6.logicList[consName].orgCopyNum=D6.logicList[consName].orgCopyNum+1}};var D6=D6||{};D6.calcCons=function(){var i,j;var ci;this.area.setCalcBaseParams();for(i=0;i<D6.consList.length;i++){this.consList[i].precalc()}for(i=0;i<D6.consList.length;i++){this.consList[i].calc();this.consList[i].calcCO2()}for(i=0;i<this.consList.length;i++){this.consList[i].calc2nd();this.consList[i].calcCO2()}this.calcConsAdjust();for(i=0;i<this.consList.length;i++){this.consList[i].calcCost();this.consList[i].calcJules();if(this.isOriginal){this.consList[i].co2Original=this.consList[i].co2;this.consList[i].costOriginal=this.consList[i].cost;this.consList[i].julesOriginal=this.consList[i].jules}}};D6.calcConsAdjust=function(){var ci,i,j;var consNum;var consSum;var energySum=D6.object(D6.Energy);D6.energyAdj=D6.object(D6.Energy);var singleArray=true;var lastname="";for(ci in this.consShow){consSum=this.consShow[ci];if(consSum.consName!="consTotal"){energySum.clear();if(consSum.partCons.length>=1){lastname=consSum.partCons[0].consName;for(i=1;i<consSum.partCons.length;i++){energySum.add(consSum.partCons[i]);if(lastname!=consSum.partCons[i].consName){singleArray=false}}energySum.calcCO2();if(consSum.residueCalc=="no"){consSum.copy(energySum);consSum.add(consSum.partCons[0]);consSum.calcCO2()}else{if(energySum.co2>consSum.co2){for(i=1;i<=consNum;i++){consSum.partCons[i].multiply(consSum.co2/energySum.co2)}consSum.partCons[0].clear()}else{if(singleArray){energySum.sub(consSum);energySum.multiply(-1);consSum.partCons[0].copy(energySum)}else{consSum.copy(energySum);consSum.add(consSum.partCons[0]);consSum.calcCO2()}}}}}}energySum.clear();for(ci in this.consShow){if(ci!="TO"){for(j in D6.Unit.co2){energySum[j]+=this.consShow[ci][j]}}}var nodataTotal=this.consShow["TO"].noConsData;energySum.electricity+=this.consShow["TO"].electricity*0.1;energyAdj=[];if(!nodataTotal){for(j in D6.Unit.co2){if(energySum[j]==0){this.energyAdj[j]=1}else{this.energyAdj[j]=Math.max(0.3,Math.min(3,this.consShow["TO"][j]/energySum[j]))}}for(ci in this.consList){if(this.consList[ci].consName!="consTotal"){this.consList[ci].calcAdjust(this.energyAdj)}}}else{for(j in D6.Unit.co2){if(j=="electricity"){if(this.consShow["TO"][j]<energySum[j]){this.consShow["TO"][j]=energySum[j]}}else{this.consShow["TO"][j]=energySum[j]}}this.consShow["TO"].calcCO2()}};D6.getTargetConsList=function(consName){var i,c=0;var target=new Array();var ret;if(consName!=""){for(i=0;i<this.consList.length;i++){if(this.consList[i].consName==consName){target[c++]=this.consList[i]}}if(target.length==1){ret=target[0]}else{ret=target}}return ret};D6.getGid=function(consName){return D6.logicList[consName].groupID};D6.getCommonParameters=function(){var ret=[];ret.co2Original=D6.consListByName["consTotal"][0].co2Original;ret.co2=D6.consListByName["consTotal"][0].co2;ret.costOriginal=D6.consListByName["consTotal"][0].costOriginal;ret.cost=D6.consListByName["consTotal"][0].cost;return ret};var D6=D6||{};D6.calcAverage=function(){D6.averageMode=true;this.calcCons();this.average.consList={};for(var c in this.consShow){this.average.consList[c]={};this.average.consList[c].co2=this.consShow[c].co2;this.average.consList[c].cost=this.consShow[c].cost;this.average.consList[c].jules=this.consShow[c].jules;this.average.consList[c].title=this.consShow[c].title}D6.averageMode=false};D6.rankIn100=function(ratio){var ret;var lognum;var width=0.5;if(ratio<=0){ratio=0.1}lognum=Math.log(ratio);if(lognum<-width){ret=Math.max(1,Math.round((lognum+1)/width*10))}else if(lognum<width){ret=Math.round((lognum+width)/(width*2)*80+10)}else{ret=Math.min(100,Math.round((lognum-width)/(width*2)*10)+90)}return ret};var D6=D6||{};D6.calcMeasures=function(gid){var ret;var calcfg=false;var i;var mid,mlistid,mes;var selList=[];for(mes in this.measureList){selList[this.measureList[mes].mesID]=this.measureList[mes].selected}ret=this.clearSelectedMeasures(gid);for(i=0;i<ret.length;i++){mid=ret[i].mesID;mlistid=mid;mes=this.measureList[mlistid];if(selList[mid]&&!mes.selected){mes.selected=true;this.isOriginal=false;if(mes.co2Change<0){mes.co2ChangeSumup=mes.co2Change;mes.costChangeSumup=mes.costChange;mes.costTotalChangeSumup=mes.costTotalChange;mes.addReduction();ret=this.calcMeasuresOne(-1)}else{mes.co2ChangeSumup=0;mes.costChangeSumup=0;mes.costTotalChangeSumup=0}}}for(mlistid in this.measureList){mes=this.measureList[mlistid];mes.selected=selList[mes.mesID];if(mes.selected){this.isOriginal=false}}var ret2=[];for(i=0;i<ret.length;i++){if(ret[i].groupID==gid||gid==-1){ret2.push(ret[i])}}this.resMeasure=ret2;if(D6.debugMode){console.log("measure calculate in d6.js calcMeasures() --- ");console.log(ret2)}return ret2};D6.calcMeasuresLifestyle=function(gid){var onemes;var retLife=new Array();var ret=D6.calcMeasures(gid);for(onemes in ret){if(ret[onemes].lifestyle==1){retLife.push(ret[onemes])}}return retLife};D6.calcMeasuresNotLifestyle=function(gid){var onemes;var retLife=[];var ret=D6.calcMeasures(gid);for(onemes in ret){if(ret[onemes].lifestyle!=1){retLife.push(ret[onemes])}}return retLife};D6.calcMeasuresOne=function(gid){var ret;var topList;var selectList;var i;var sortTarget=this.sortTarget;ret=new Array();topList=new Array();selectList=new Array();for(i in this.consList){if(gid==-1||this.consList[i].groupID==gid){this.consList[i].calcMeasureInit();this.consList[i].calcMeasure();if(this.consList[i].subID>=1){var cons0=this.consListByName[this.consList[i].consName][0];for(var m in cons0.measures){if(cons0.measures[m].selected){this.consList[i].measures[m].copy(cons0)}}}}}i=0;for(var mescode in this.measureList){var mes=this.measureList[mescode];mes.calcSave();ret[i]={};ret[i][sortTarget]=mes[sortTarget];ret[i].mesID=mes.mesID;ret[i].groupID=mes.groupID;ret[i].lifestyle=mes.lifestyle;i++}this.ObjArraySort(ret,sortTarget);return ret};D6.clearSelectedMeasures=function(gid){var ret;this.isOriginal=true;ret=this.calcCons();for(var i=0;i<D6.measureList.length;i++){if(this.measureList[i].groupID==gid||gid<0){this.measureList[i].selected=false}}ret=this.calcMeasuresOne(gid);return ret};D6.calcMaxMeasuresList=function(gid,count){var resultCalc;var ret;var pt=0;var maxCO2=0;var cost=0;var i,j;var mes;var targetmes;var sumCO2=0;var sumCOST=0;if(typeof(gid)=="undefined")gid=-1;if(typeof(count)=="undefined"||count<1)count=15;resultCalc=this.clearSelectedMeasures(gid);for(i=0;i<count;i++){pt=-1;maxCO2=0;for(j=0;j<this.measureList.length;j++){mes=this.measureList[j];if(mes.groupID==gid||gid<0){if(measureList[j].selected!=true||!isFinite(mes.co2Change)||isNaN(mes.co2Change)){if(maxCO2>mes.co2Change){maxCO2=mes.co2Change;cost=mes.costChange;pt=mes.mesID;targetmes=mes}}}}if(pt==-1){break}sumCO2+=maxCO2;sumCOST+=cost;resultCalc=this.measureAdd(pt);targetmes.addReduction();resultCalc=this.calcMeasuresOne(-1)}ret=calcMeasures(gid);ret.sumCO2=sumCO2;ret.sumCOST=sumCOST;return ret};var D6=D6||{};D6.inSet=function(id,val){var inpIdDef=id.substr(0,4);if(D6.scenario.defInput[inpIdDef].varType=="String"||D6.scenario.defInput[inpIdDef].varType=="Boolean"){D6.doc.data[id]=val}else{val=D6.toHalfWidth(val);D6.doc.data[id]=parseFloat(val)?parseFloat(val):0}};D6.measureAdd=function(mesId){var gid;var ret="";gid=this.measureList[mesId].groupID;this.measureList[mesId].selected=true;this.isOriginal=false;return ret};D6.measureDelete=function(mesId){var gid;var ret="";this.measureList[mesId].selected=false;gid=this.measureList[mesId].groupID;return ret};var D6=D6||{};D6.toHalfWidth=function(strVal){if(!strVal)return strVal;var halfVal=strVal.replace(/[！-～]/g,function(tmpStr){return String.fromCharCode(tmpStr.charCodeAt(0)-0xFEE0)});return halfVal};D6.ObjArraySort=function(ary,key,order){var reverse=1;if(order&&order.toLowerCase()=="desc")reverse=-1;ary.sort(function(a,b){if(a[key]<b[key])return-1*reverse;else if(a[key]==b[key])return 0;else return 1*reverse})};;
